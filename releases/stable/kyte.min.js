/**
    * Copyright 2020-2026 KeyQ, Inc.
    * 
    * This source file is free software,
    * available under the following license:
    * MIT license
    * 
    * This source file is distributed in the hope that
    * it will be useful, but WITHOUT ANY WARRANTY;
    * without even the implied warranty of MERCHANTABILITY
    * or FITNESS FOR A PARTICULAR PURPOSE.
    * See the license files for details.
    * 
    * For details please refer to: http://www.keyq.cloud
    * KyteJS
    * ©2020-2026 KeyQ, Inc.
    **/
class Kyte{static VERSION="1.3.0";constructor(e,t,a,i,s=null){this.url=e,this.access_key=t,this.identifier=a,this.account_number=i,this.applicationId=s,this.initial_access_key=t,this.initial_identifier=a,this.initial_account_number=i,this.txToken,this.sessionToken,this.dateFormat="mm/dd/yy",this.sessionCrossDomain=!1,this.sessionTimer=null,this.redirectToLoginInitiated=!1,this.sessionController="Session"}init=()=>{this.access_key=this.getCookie("kyte_pub")?this.getCookie("kyte_pub"):this.access_key,this.identifier=this.getCookie("kyte_iden")?this.getCookie("kyte_iden"):this.identifier,this.account_number=this.getCookie("kyte_num")?this.getCookie("kyte_num"):this.account_number,this.txToken=this.getCookie("txToken")?this.getCookie("txToken"):0,this.sessionToken=this.getCookie("sessionToken")?this.getCookie("sessionToken"):0,console.info(`Initialized KyteJS v${Kyte.VERSION}`)};apiVersion=(e,t=null)=>{var a=this;$.ajax({method:"GET",crossDomain:!0,dataType:"json",url:a.url,success:function(t){"function"==typeof e?e(t.engine_version,t.framework_version):console.log("Engine: "+t.engine_version+"; Framework: "+t.framework_version)},error:function(e){"function"==typeof t?t(e.responseJSON.error):console.error(e.responseJSON.error)}})};sign=(e,t=null)=>{var a=new Date,i=this;$.ajax({method:"POST",crossDomain:!0,dataType:"json",url:i.url,data:"key="+i.access_key+"&identifier="+i.identifier+"&token="+i.txToken+"&time="+a.toUTCString(),success:function(t){"function"==typeof e?e(t,a):console.log(t)},error:function(e){"function"==typeof t?t(e):console.error(e)}})};sendData=(e,t,a=null,i=null,s=null,l=null,o=[],n,d=null)=>{var r=this;this.sign(function(c,h){let u=encodeURIComponent(btoa(r.access_key+"%"+r.sessionToken+"%"+h.toUTCString()+"%"+r.account_number));var p=r.url+"/"+t;a&&(p+="/"+encodeURIComponent(a)),i&&(p+="/"+encodeURIComponent(i));var m="";s&&(m+=$.param(s)),l&&(m&&(m+="&"),m+=l),$.ajax({method:e,crossDomain:!0,dataType:"json",url:p,beforeSend:function(e){if(e.setRequestHeader("x-kyte-signature",c.signature),e.setRequestHeader("x-kyte-identity",u),r.applicationId&&e.setRequestHeader("x-kyte-appid",r.applicationId),e.setRequestHeader("x-kyte-device",window.navigator.userAgent),o.length>0)for(let t of o)e.setRequestHeader(t.name,t.value)},data:m,success:function(e){e.syntax_error&&r.syntaxErrorBanner(e.syntax_error),r.txToken=e.token,r.sessionToken=e.session,e.kyte_pub&&e.kyte_iden&&e.kyte_num?(r.access_key=e.kyte_pub,r.identifier=e.kyte_iden,r.account_number=e.kyte_num,r.setCookie("kyte_pub",r.access_key,60,r.sessionCrossDomain),r.setCookie("kyte_iden",r.identifier,60,r.sessionCrossDomain),r.setCookie("kyte_num",r.account_number,60,r.sessionCrossDomain)):(r.setCookie("kyte_pub","",-1),r.setCookie("kyte_num","",-1),r.setCookie("kyte_iden","",-1),r.access_key=r.initial_access_key,r.identifier=r.initial_identifier,r.account_number=r.initial_account_number),e.token||e.session?(r.setCookie("txToken",r.txToken,60,r.sessionCrossDomain),r.setCookie("sessionToken",r.sessionToken,60,r.sessionCrossDomain),r.setCookie("accountIdx",e.account_id,60,r.sessionCrossDomain),r.setCookie("roleIdx",e.role?e.role.id:0,60,r.sessionCrossDomain),r.setCookie("roleName",e.role?e.role.name:null,60,r.sessionCrossDomain)):r.sessionDestroy(),"function"==typeof n?n(e):console.log(e)},error:function(e){e.syntax_error&&r.syntaxErrorBanner(e.syntax_error),403==e.status?(r.sessionDestroy(),r.sessionTimer&&clearInterval(r.sessionTimer),t!=r.sessionController&&r.redirectToLogin()):null!=e.responseJSON&&(r.txToken=e.responseJSON.token,r.sessionToken=e.responseJSON.session,e.kyte_pub&&e.kyte_iden&&e.kyte_num?(r.access_key=e.kyte_pub,r.identifier=e.kyte_iden,r.account_number=e.kyte_num,r.setCookie("kyte_pub",r.access_key,60,r.sessionCrossDomain),r.setCookie("kyte_iden",r.identifier,60),r.sessionCrossDomain,r.setCookie("kyte_num",r.account_number,60,r.sessionCrossDomain)):(r.setCookie("kyte_pub","",-1),r.setCookie("kyte_num","",-1),r.setCookie("kyte_iden","",-1),r.access_key=r.initial_access_key,r.identifier=r.initial_identifier,r.account_number=r.initial_account_number),e.responseJSON.token||e.responseJSON.session?(r.setCookie("txToken",r.txToken,60,r.sessionCrossDomain),r.setCookie("sessionToken",r.sessionToken,60,r.sessionCrossDomain),r.setCookie("accountIdx",e.account_id,60,r.sessionCrossDomain),r.setCookie("roleIdx",e.role?e.role.id:0,60,r.sessionCrossDomain),r.setCookie("roleName",e.role?e.role.name:null,60,r.sessionCrossDomain)):r.sessionDestroy()),null==e.responseJSON?console.log(e):"function"==typeof d?d(e.responseJSON.error):console.error(e.responseJSON.error)}})},function(e){null==e.responseJSON?console.error(e):"function"==typeof d?d(e):console.error(e)})};post=(e,t=null,a=null,i=[],s,l=null)=>{this.sendData("POST",e,null,null,t,a,i,s,l)};put=(e,t=null,a=null,i=null,s=null,l=[],o,n=null)=>{this.sendData("PUT",e,t,a,i,s,l,o,n)};get=(e,t=null,a=null,i=[],s,l=null)=>{this.sendData("GET",e,t,a,null,null,i,s,l)};delete=(e,t=null,a=null,i=[],s,l=null)=>{this.sendData("DELETE",e,t,a,null,null,i,s,l)};setCookie=(e,t,a=null,i=!1)=>{var s="";if(a){var l=new Date;l.setTime(l.getTime()+6e4*a),s=";expires="+l.toUTCString()}let o=window.location.hostname.split("."),n="";i&&(o.length>2?n="domain="+o.slice(1).join(".")+";":2==o.length&&(n="domain="+o.joing(".")+";")),document.cookie=e+"="+t+s+";path=/;"+n+("https:"===location.protocol?"secure;":"")};getCookie=e=>{for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var s=a[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null};getUrlHash=()=>location.hash;getUrlParameter=e=>{var t,a,i,s=window.location.search.substring(1).split("&");for(a=0;a<s.length;a++)if((t=s[a].split("="))[0]===e)return void 0!==t[1]&&decodeURIComponent(t[1]);return!1};getPageRequest=()=>{let e=this.getUrlParameter("request");return e?JSON.parse(decodeURIComponent(atob(e))):null};setPageRequest=(e,t)=>{let a;return encodeURIComponent(btoa(JSON.stringify({model:e,value:t})))};initSpinner=e=>{e.append('<div id="pageLoaderModal" class="modal" style="background: white; opacity: 0.6;" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"><div class="modal-dialog modal-sm h-100 d-flex"><div class="mx-auto align-self-center" style="width: 48px"><div class="spinner-wrapper text-center fa-6x"><span class="fas fa-sync fa-spin"></span></div></div></div></div>')};startSpinner=()=>{$("#pageLoaderModal").modal()};stopSpinner=()=>{$("#pageLoaderModal").modal("hide")};sessionCreate=(e,t,a=null,i=null)=>{var s=this;null!==i&&(s.sessionController=i),this.post(s.sessionController,e,null,[],function(e){s.txToken=e.token,s.sessionToken=e.session,s.setCookie("txToken",s.txToken,60,s.sessionCrossDomain),s.setCookie("sessionToken",s.sessionToken,60,s.sessionCrossDomain),s.setCookie("accountIdx",e.account_id,60,s.sessionCrossDomain),s.setCookie("roleIdx",e.role?e.role.id:0,60,s.sessionCrossDomain),s.setCookie("roleName",e.role?e.role.name:null,60,s.sessionCrossDomain),s.access_key=e.kyte_pub,s.identifier=e.kyte_iden,s.account_number=e.kyte_num,s.setCookie("kyte_pub",s.access_key,60,s.sessionCrossDomain),s.setCookie("kyte_iden",s.identifier,60,s.sessionCrossDomain),s.setCookie("kyte_num",s.account_number,60,s.sessionCrossDomain),"function"==typeof t?t(e):console.log(e)},function(e){s.sessionDestroy(),"function"==typeof a?a(e):console.error(e)})};addLogoutHandler=e=>{self=this,$("body").on("click",e,function(){self.sessionDestroy(function(){location.href="/"})})};checkSession=()=>(this.sessionToken&&"0"!==this.sessionToken&&this.txToken&&"0"!==this.txToken||this.sessionDestroy(),!!this.getCookie("sessionToken"));redirectToLogin=()=>{if(!this.redirectToLoginInitiated){this.redirectToLoginInitiated=!0,this.stopSpinner();let e=this;this.alert("Please sign in again","You were signed out of your account.  Please press 'OK' to sign in to your account again.",function(){var t=window.location.href;e.redirectToLoginInitiated=!1,window.location.href="/?redir="+encodeURIComponent(t)},!1)}};isSession=(e=!0,t=!0,a=3e4)=>{let i=this,s=this.checkSession();return s&&e&&(this.sessionTimer=setInterval(function(){!i.checkSession()&&(clearInterval(i.sessionTimer),t&&i.redirectToLogin())},a)),s};sessionDestroy=(e=null)=>{var t=this;this.delete("Session",null,null,[],function(t){"function"==typeof e?e(t):console.error(t)},function(t){"function"==typeof e?e(t):console.error(t)}),t.setCookie("txToken","",-1),t.setCookie("sessionToken","",-1),t.setCookie("accountIdx","",-1),t.setCookie("roleIdx","",-1),t.setCookie("roleName","",-1),t.setCookie("kyte_pub","",-1),t.setCookie("kyte_num","",-1),t.setCookie("kyte_iden","",-1),t.access_key=t.initial_access_key,t.identifier=t.initial_identifier,t.account_number=t.initial_account_number,t.sessionToken=0,t.txToken=0};makeid=e=>{for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=a.length,s=0;s<e;s++)t+=a.charAt(Math.floor(Math.random()*i));return t};alert=(e,t,a=null,i=!0)=>{this.makeid(5),$("<div></div>").appendTo("body").html("<div><h6>"+t+"</h6></div>").dialog({modal:!0,title:e,zIndex:1e4,autoOpen:!0,width:"auto",resizable:!1,closeOnEscape:i,open:function(e,t){i||$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){"function"==typeof a&&a(),$(this).dialog("close")}},close:function(e,t){$(this).remove()}})};confirm=(e,t,a=null,i=null)=>{this.makeid(5),$("<div></div>").appendTo("body").html("<div><h6>"+t+"</h6></div>").dialog({modal:!0,title:e,zIndex:1e4,autoOpen:!0,width:"auto",resizeable:!1,buttons:[{class:"btn btn-danger btn-delete-confirm-yes",text:"Yes",click:function(){"function"==typeof a&&a(),$(this).dialog("close")}},{class:"btn btn-secondary btn-delete-confirm-no",text:"No",click:function(){"function"==typeof i&&i(),$(this).dialog("close")}}],close:function(e,t){$(this).remove()}})};validateForm=e=>{let t=!0;return e.find("input").each(function(){$(this).prop("required")&&!$(this).val()&&(t=!1)}),t};syntaxErrorBanner=e=>{$("body").prepend('<div class="card text-white bg-danger m-3"><div class="card-header">Syntax Error</div><div class="card-body"><p class="card-text">'+e+"</p></div></div>")};getNestedValue=(e,t)=>t.split(".").reduce((e,t)=>e?e[t]:void 0,e)}class KyteNav{constructor(e,t,a=null,i=null,s=null,l="/app/"){this.selector=e,this.nav_struct=t,this.logo=a,this.title=i,this.active=s,this.link=l}create=()=>{let e='		<div class="container-fluid">			<a href="'+this.link+'" class="navbar-brand">'+(this.logo?'<img src="'+this.logo+'" style="height: 45px;" class="me-2 rounded">':"")+(this.title?this.title:"")+'</a>			<button data-bs-toggle="collapse" class="navbar-toggler" type="button" data-bs-target="#navcol-1" aria-controls="#navcol-1" aria-expanded="false" aria-label="Toggle navigation">				<span class="navbar-toggler-icon"></span>			</button>			<div class="collapse navbar-collapse" id="navcol-1">',t=0;this.nav_struct.forEach(a=>{e+=0==t?'<ul class="navbar-nav mx-auto">':'<ul class="navbar-nav">',t++,a.forEach(t=>{t.dropdown?(e+=`
					<li class="nav-item dropdown">
						<a id="${t.id?t.id:""}" class="nav-link dropdown-toggle ${t.class}" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">${t.faicon?'<i class="'+t.faicon+' me-2"></i>':""}<span>${t.label}</span></a>
						<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">`,t.items.forEach(t=>{e+=`<li><a id="${t.id?t.id:""}" class="dropdown-item ${t.class}${t.logout?" logout":""}" ${t.href?'href="'+t.href+'"':'href="#"'}>${t.faicon?'<i class="'+t.faicon+' me-2"></i>':""}<span>${t.label}</span></a></li>`}),e+="</ul></li>"):e+=`<li class="nav-item"><a id="${t.id?t.id:""}" class="nav-link${t.logout?" logout":""}${t.labelCenterBlock?" text-center p-0 my-1 mx-0":""}${t.label==this.active?" active":""} ${t.class}" ${t.href?'href="'+t.href+'"':'href="#"'}>${t.faicon?'<i class="'+t.faicon+(t.labelCenterBlock?" d-block":" me-2")+'"></i>':""}<span>${t.label}</span></a></li>`}),e+="</ul>"}),e+="			</div>		</div>",$(this.selector).html(e)}}class KyteSidenav{constructor(e,t,a){this.selector=e,this.nav_struct=t,this.default_page_selector=a}create=()=>{if($(this.selector).length){let e='<ul class="nav nav-pills flex-column mb-auto" id="sidebar-nav">';this.nav_struct.forEach(t=>{($(t.selector).length||t.href||t.logout)&&(e+='<li class="nav-item">',e+=`<a ${$(t.selector).length?'id="'+t.selector.replace("#","")+'-nav-link" ':t.id?'id="'+t.id+'"':""} ${'href="'+(t.logout?"#":t.href?t.href:t.selector)+'"'} class="nav-link ${t.class?t.class:""} ${t.labelCenterBlock?" text-center p-0 my-1 mx-0":""} ${t.logout?"logout":""}"><i class="${t.faicon}${t.labelCenterBlock?" d-block":" me-2"}"></i><span>${t.label}</span></a>`,e+="</li>")}),e+="</ul>",$(this.selector).html(e)}};bind=(e=null)=>{let t=this,a=location.hash;$(a=""==a?this.default_page_selector:a).removeClass("d-none"),$(a+"-nav-link").addClass("active"),this.nav_struct.forEach(a=>{$(a.selector+"-nav-link").click(function(i){history.pushState({},"",this.href),i.preventDefault(),$(a.selector+"-nav-link").addClass("active"),$(a.selector).removeClass("d-none"),"function"==typeof e&&e(a),t.nav_struct.forEach(e=>{e.selector!=a.selector&&($(e.selector+"-nav-link").removeClass("active"),$(e.selector).addClass("d-none"))})})})}}class KyteTable{constructor(e,t,a,i,s=!0,l=[],o=!1,n=!1,d=!1,r=null,c=null,h=null){this.api=e,this.model=a,this.httpHeaders=[],this.loaded=!1,this.table=null,this.selector=t,this.lang="https://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/English.json",this.searching=s,this.columnDefs=i,this.order=l,this.actionEdit=o,this.editForm=null,this.actionDelete=n,this.actionView=d,this.viewTarget=r,this.targetBlank=!1,this.rowCallBack=c,this.initComplete=h,this.processing=!0,this.serverside=!0,this.customAction=null,this.customActionButton=null,this.deleteDisplayHook=null,this.editDisplayHook=null,this.page_idx=1,this.pageLength=50,this.data=[],this.totalRecords=0,this.filteredRecords=0,this.currentPage=1,this.searchValue="",this.sortColumn=null,this.sortDirection="asc",this.isLoading=!1,this.draw=0,this.container=null,this.tableElement=null,this.searchInput=null,this.paginationContainer=null}init=()=>{if(!this.loaded){if(this.order&&this.order.length>0){let e=this.order[0][0];e<this.columnDefs.length&&this.columnDefs[e]&&this.columnDefs[e].data&&(this.sortColumn=this.columnDefs[e].data,this.sortDirection=this.order[0][1])}this._buildTableStructure(),this._bindEvents(),this._loadData(),this.loaded=!0,"function"==typeof this.initComplete&&setTimeout(()=>this.initComplete(),100)}};_buildTableStructure=()=>{if(this.selector.empty(),this._injectStyles(),this.container=$('<div class="kyte-table-container"></div>'),this.selector.append(this.container),this.searching){let e=$(`
				<div class="kyte-table-toolbar">
					<div class="kyte-table-search">
						<i class="fas fa-search"></i>
						<input type="text" placeholder="Search..." class="kyte-table-search-input" />
						<button class="kyte-table-search-clear" style="display:none;">
							<i class="fas fa-times"></i>
						</button>
					</div>
					<div class="kyte-table-info">
						<span class="kyte-table-record-count">Loading...</span>
					</div>
				</div>
			`);this.container.append(e),this.searchInput=e.find(".kyte-table-search-input")}let t=$('<div class="kyte-table-wrapper"></div>');this.container.append(t),this.tableElement=$('<table class="kyte-table"></table>'),t.append(this.tableElement);let a=$("<thead></thead>"),i=$("<tr></tr>");this.columnDefs.forEach((e,t)=>{let a=$(`
				<th class="kyte-table-th ${e.data.replace(/\./g,"_")}" data-column="${e.data}">
					<div class="kyte-table-th-content">
						<span class="kyte-table-th-label">${e.label||e.data}</span>
						${!1!==e.sortable?'<span class="kyte-table-sort-indicator"></span>':""}
					</div>
				</th>
			`);!1!==e.sortable&&a.addClass("kyte-table-sortable"),i.append(a)}),(this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0||this.customActionButton&&this.customActionButton.length>0)&&i.append('<th class="kyte-table-th kyte-table-actions-header"></th>'),a.append(i),this.tableElement.append(a);let s=$('<tbody class="kyte-table-body"></tbody>');this.tableElement.append(s);let l=$(`
			<div class="kyte-table-footer">
				<div class="kyte-table-page-size">
					<label>
						Show
						<select class="kyte-table-page-size-select">
							<option value="10">10</option>
							<option value="25">25</option>
							<option value="50" selected>50</option>
							<option value="100">100</option>
						</select>
						entries
					</label>
				</div>
				<div class="kyte-table-pagination"></div>
			</div>
		`);this.container.append(l),this.paginationContainer=l.find(".kyte-table-pagination"),this.actionView&&s.addClass("kyte-table-clickable")};_bindEvents=()=>{let e=this;if(this.searchInput){let t;this.searchInput.on("input",function(){let a=$(this).val();clearTimeout(t),t=setTimeout(()=>{e.searchValue=a,e.currentPage=1,e._loadData();let t=$(this).siblings(".kyte-table-search-clear");a?t.show():t.hide()},300)}),this.container.find(".kyte-table-search-clear").on("click",function(){e.searchInput.val(""),e.searchValue="",e.currentPage=1,e._loadData(),$(this).hide()})}this.tableElement.find(".kyte-table-sortable").on("click",function(){let t=$(this).data("column");e.sortColumn===t?e.sortDirection="asc"===e.sortDirection?"desc":"asc":(e.sortColumn=t,e.sortDirection="asc"),e._updateSortIndicators(),e._loadData()}),this.container.find(".kyte-table-page-size-select").on("change",function(){e.pageLength=parseInt($(this).val()),e.currentPage=1,e._loadData()}),this.actionDelete&&this.tableElement.on("click",".kyte-table-action-delete",function(t){t.stopPropagation(),t.preventDefault();let a=$(this).closest("tr").data("rowData");e.api.confirm("Delete","Are you sure you wish to delete?",function(){e.api.delete(e.model.name,"id",a.id,e.httpHeaders,function(){e._loadData()},function(){e.api.alert("Error","Unable to delete. Please try again later.")})})}),this.actionEdit&&this.tableElement.on("click",".kyte-table-action-edit",function(t){if(t.stopPropagation(),t.preventDefault(),e.editForm){let a=$(this).closest("tr").data("rowData"),i=$(this).closest("tr");e.editForm.selectedRow={data:()=>a,node:()=>i[0]},e.editForm.setID(a.id),e.editForm.showModal()}}),e.customAction&&e.customAction.length>0&&e.customAction.forEach(t=>{e.tableElement.on("click",".kyte-table-action-"+t.className,function(a){a.stopPropagation(),a.preventDefault();let i=$(this).closest("tr").data("rowData"),s=$(this).closest("tr");t.callback(i,e.model.name,{data:()=>i,node:()=>s[0]})})}),e.customActionButton&&e.customActionButton.length>0&&e.customActionButton.forEach(t=>{e.tableElement.on("click",".kyte-table-action-"+t.className,function(a){a.stopPropagation(),a.preventDefault();let i=$(this).closest("tr").data("rowData"),s=$(this).closest("tr");t.callback(i,e.model.name,{data:()=>i,node:()=>s[0]})})}),this.actionView&&this.tableElement.on("click","tbody tr",function(t){if($(t.target).closest(".kyte-table-actions").length>0)return;let a=$(this).data("rowData");if(e.viewTarget&&a){let i=e.api.getNestedValue(a,e.actionView),s={model:e.model.name,idx:i},l=encodeURIComponent(btoa(JSON.stringify(s)));e.targetBlank?window.open(e.viewTarget+"?request="+l,"_blank").focus():location.href=e.viewTarget+"?request="+l}})};_loadData=()=>{let e=this;if(this.isLoading)return;this.isLoading=!0,this.draw++,this._showSkeleton();let t=[];this.columnDefs.forEach(e=>{e.data&&t.push(e.data)});let a=[];a.push({name:"x-kyte-draw",value:this.draw}),a.push({name:"x-kyte-page-size",value:this.pageLength}),a.push({name:"x-kyte-page-idx",value:this.currentPage}),a.push({name:"x-kyte-page-search-value",value:this.searchValue?btoa(encodeURIComponent(this.searchValue)):""}),a.push({name:"x-kyte-page-search-fields",value:t.join(",")}),this.sortColumn&&(a.push({name:"x-kyte-page-order-col",value:this.sortColumn}),a.push({name:"x-kyte-page-order-dir",value:this.sortDirection}));let i=[...this.httpHeaders,...a];this.api.get(this.model.name,this.model.field,this.model.value,i,function(t){e.data=t.data||[],e.totalRecords=parseInt(t.total_count)||0,e.filteredRecords=parseInt(t.total_filtered)||0,e._renderData(),e._updatePagination(),e._updateRecordCount(),e.isLoading=!1},function(t){console.error(`Unable to load table data for ${e.model.name}`,t),e._showError(),e.isLoading=!1})};_showSkeleton=()=>{let e=this.tableElement.find("tbody");e.empty();let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0);for(let a=0;a<8;a++){let i=$('<tr class="kyte-table-skeleton-row"></tr>');for(let s=0;s<t;s++)i.append('<td><div class="kyte-table-skeleton"></div></td>');e.append(i)}};_showError=()=>{let e=this.tableElement.find("tbody");e.empty();let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0),a=$(`
			<tr class="kyte-table-error-row">
				<td colspan="${t}" class="kyte-table-error">
					<i class="fas fa-exclamation-triangle"></i>
					<span>Failed to load data. Please try again.</span>
				</td>
			</tr>
		`);e.append(a)};_renderData=()=>{let e=this.tableElement.find("tbody");if(e.empty(),0===this.data.length){let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0),a=$(`
				<tr class="kyte-table-empty-row">
					<td colspan="${t}" class="kyte-table-empty">
						<i class="fas fa-inbox"></i>
						<span>No data available</span>
					</td>
				</tr>
			`);e.append(a);return}this.data.forEach((t,a)=>{let i=$("<tr></tr>");if(i.data("rowData",t),this.columnDefs.forEach(e=>{let s=$("<td></td>"),l=this.api.getNestedValue(t,e.data);"function"==typeof e.render&&(l=e.render(l,"display",t,{row:a,col:e})),s.html(l),i.append(s)}),this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0||this.customActionButton&&this.customActionButton.length>0){let s=$('<td class="kyte-table-actions"></td>'),l="";if(this.customActionButton&&this.customActionButton.length>0&&this.customActionButton.forEach(e=>{e.className&&e.label&&"function"==typeof e.callback&&(l+=`<button class="kyte-table-action-btn kyte-table-action-${e.className}">${e.faicon?'<i class="'+e.faicon+'"></i> ':""}${e.label}</button>`)}),this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0){let o='<div class="kyte-table-actions-dropdown"><button class="kyte-table-actions-toggle"><i class="fas fa-ellipsis-v"></i></button><div class="kyte-table-actions-menu">';if(this.actionEdit){let n='<a href="#" class="kyte-table-action-edit"><i class="fas fa-edit"></i> Edit</a>';"function"==typeof this.editDisplayHook&&(n=this.editDisplayHook(t,this.model.name,n)),o+=n}if(this.actionDelete){let d='<a href="#" class="kyte-table-action-delete"><i class="fas fa-trash-alt"></i> Delete</a>';"function"==typeof this.deleteDisplayHook&&(d=this.deleteDisplayHook(t,this.model.name,d)),o+=d}this.customAction&&this.customAction.length>0&&(o+='<div class="kyte-table-actions-divider"></div>',this.customAction.forEach(e=>{e.className&&e.label&&"function"==typeof e.callback&&(o+=`<a href="#" class="kyte-table-action-${e.className}">${e.faicon?'<i class="'+e.faicon+'"></i> ':""}${e.label}</a>`)})),o+="</div></div>",l+=o}s.html(l),i.append(s)}"function"==typeof this.rowCallBack&&this.rowCallBack(i[0],t,a),e.append(i)}),this._bindDropdownToggle()};_bindDropdownToggle=()=>{this.tableElement.find(".kyte-table-actions-toggle").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let t=$(this),a=t.next(".kyte-table-actions-menu"),i=t.closest(".kyte-table-actions");$(".kyte-table-actions-menu").not(a).removeClass("kyte-table-actions-menu-open kyte-table-actions-menu-up"),$(".kyte-table-actions").not(i).removeClass("dropdown-open");let s=a.hasClass("kyte-table-actions-menu-open");if(s)a.removeClass("kyte-table-actions-menu-open"),i.removeClass("dropdown-open");else{a.css({visibility:"hidden",display:"block"});let l=a.outerHeight();a.css({visibility:"",display:""});let o=t[0].getBoundingClientRect(),n=window.innerHeight,d=window.innerWidth,r=n-o.bottom-10,c=o.top-10,h,u;(h=r>=l||r>=c?o.bottom+4:o.top-l-4)+l>n&&(h=n-l-10),h<10&&(h=10),(u=d-o.right)<10&&(u=10),a.css({top:h+"px",right:u+"px",left:"auto",bottom:"auto"}),a.addClass("kyte-table-actions-menu-open"),i.addClass("dropdown-open")}}),$(document).on("click",function(e){$(e.target).closest(".kyte-table-actions-dropdown").length||($(".kyte-table-actions-menu").removeClass("kyte-table-actions-menu-open kyte-table-actions-menu-up"),$(".kyte-table-actions").removeClass("dropdown-open"))})};_updateSortIndicators=()=>{if(this.tableElement.find(".kyte-table-th").removeClass("kyte-table-sorted-asc kyte-table-sorted-desc"),this.sortColumn){let e=this.tableElement.find(`.kyte-table-th[data-column="${this.sortColumn}"]`);e.addClass(`kyte-table-sorted-${this.sortDirection}`)}};_updatePagination=()=>{let e=this,t=Math.ceil(this.filteredRecords/this.pageLength);if(this.paginationContainer.empty(),t<=1)return;let a=$('<div class="kyte-table-page-buttons"></div>'),i=$(`<button class="kyte-table-page-btn ${1===this.currentPage?"disabled":""}" data-page="${this.currentPage-1}"><i class="fas fa-chevron-left"></i></button>`);a.append(i);let s=Math.max(1,this.currentPage-Math.floor(3.5)),l=Math.min(t,s+7-1);l-s<6&&(s=Math.max(1,l-7+1)),s>1&&(a.append('<button class="kyte-table-page-btn" data-page="1">1</button>'),s>2&&a.append('<span class="kyte-table-page-ellipsis">...</span>'));for(let o=s;o<=l;o++){let n=$(`<button class="kyte-table-page-btn ${o===this.currentPage?"active":""}" data-page="${o}">${o}</button>`);a.append(n)}l<t&&(l<t-1&&a.append('<span class="kyte-table-page-ellipsis">...</span>'),a.append(`<button class="kyte-table-page-btn" data-page="${t}">${t}</button>`));let d=$(`<button class="kyte-table-page-btn ${this.currentPage===t?"disabled":""}" data-page="${this.currentPage+1}"><i class="fas fa-chevron-right"></i></button>`);a.append(d),this.paginationContainer.append(a),a.find(".kyte-table-page-btn:not(.disabled)").on("click",function(){let t=parseInt($(this).data("page"));t&&t!==e.currentPage&&(e.currentPage=t,e._loadData())})};_updateRecordCount=()=>{let e=(this.currentPage-1)*this.pageLength+1,t=Math.min(this.currentPage*this.pageLength,this.filteredRecords),a="";a=0===this.filteredRecords?"No entries":this.filteredRecords===this.totalRecords?`Showing ${e} to ${t} of ${this.totalRecords} entries`:`Showing ${e} to ${t} of ${this.filteredRecords} entries (filtered from ${this.totalRecords} total)`,this.container.find(".kyte-table-record-count").text(a)};_injectStyles=()=>{if($("#kyte-table-styles").length>0)return;let e=`
			<style id="kyte-table-styles">
				.kyte-table-container {
					font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
					font-size: 14px;
					color: #2d3748;
					background: white;
					box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
					overflow: visible;
					position: relative;
				}

				.kyte-table-toolbar {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 16px 20px;
					background: #f8fafc;
					border-bottom: 1px solid #e2e8f0;
					border-radius: 8px 8px 0 0;
				}

				.kyte-table-search {
					position: relative;
					display: flex;
					align-items: center;
				}

				.kyte-table-search i {
					position: absolute;
					left: 12px;
					color: #a0aec0;
					pointer-events: none;
				}

				.kyte-table-search-input {
					padding: 8px 36px 8px 36px;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					font-size: 14px;
					width: 300px;
					transition: all 0.2s;
				}

				.kyte-table-search-input:focus {
					outline: none;
					border-color: #ff6b35;
					box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
				}

				.kyte-table-search-clear {
					position: absolute;
					right: 8px;
					background: none;
					border: none;
					color: #a0aec0;
					cursor: pointer;
					padding: 4px;
					border-radius: 4px;
					transition: all 0.2s;
				}

				.kyte-table-search-clear:hover {
					color: #718096;
					background: #e2e8f0;
				}

				.kyte-table-info {
					color: #718096;
					font-size: 13px;
				}

				.kyte-table-wrapper {
					overflow-x: auto;
					overflow-y: visible;
					position: relative;
				}

				.kyte-table {
					width: 100%;
					border-collapse: collapse;
					border-spacing: 0;
					overflow: visible;
				}

				.kyte-table tbody {
					overflow: visible;
				}

				.kyte-table thead {
					position: sticky;
					top: 0;
					z-index: 9;
					background: white;
				}

				.kyte-table-th {
					text-align: left;
					padding: 12px 16px;
					font-weight: 600;
					color: #4a5568;
					background: #f8fafc;
					border-bottom: 2px solid #e2e8f0;
					white-space: nowrap;
					user-select: none;
				}

				.kyte-table-th-content {
					display: flex;
					align-items: center;
					gap: 8px;
				}

				.kyte-table-sortable {
					cursor: pointer;
					transition: background 0.2s;
				}

				.kyte-table-sortable:hover {
					background: #edf2f7;
				}

				.kyte-table-sort-indicator {
					display: inline-block;
					width: 12px;
					height: 12px;
					opacity: 0.3;
				}

				.kyte-table-sort-indicator::before {
					content: '⇅';
					font-size: 12px;
				}

				.kyte-table-sorted-asc .kyte-table-sort-indicator {
					opacity: 1;
				}

				.kyte-table-sorted-asc .kyte-table-sort-indicator::before {
					content: '↑';
				}

				.kyte-table-sorted-desc .kyte-table-sort-indicator {
					opacity: 1;
				}

				.kyte-table-sorted-desc .kyte-table-sort-indicator::before {
					content: '↓';
				}

				.kyte-table-body tr {
					border-bottom: 1px solid #e2e8f0;
					transition: background 0.2s;
				}

				.kyte-table-body tr:hover {
					background: #f8fafc;
				}

				.kyte-table-body.kyte-table-clickable tr {
					cursor: pointer;
				}

				.kyte-table-body.kyte-table-clickable tr:hover {
					background: #edf2f7;
				}

				.kyte-table-body td {
					padding: 12px 16px;
					color: #2d3748;
					vertical-align: middle;
				}

				.kyte-table-actions {
					text-align: right;
					white-space: nowrap;
					position: relative;
					z-index: 1;
				}

				.kyte-table-actions.dropdown-open {
					z-index: 1001;
				}

				.kyte-table-actions-header {
					width: 80px;
				}

				.kyte-table-action-btn {
					display: inline-block;
					padding: 6px 12px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					font-size: 13px;
					cursor: pointer;
					transition: all 0.2s;
					margin-left: 8px;
				}

				.kyte-table-action-btn:hover {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-actions-dropdown {
					position: relative;
					display: inline-block;
				}

				.kyte-table-actions-toggle {
					padding: 6px 10px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					cursor: pointer;
					transition: all 0.2s;
				}

				.kyte-table-actions-toggle:hover {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-actions-menu {
					position: fixed;
					min-width: 160px;
					background: white;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
					display: none;
					z-index: 9999;
					max-height: 400px;
					overflow-y: auto;
				}

				.kyte-table-actions-menu.kyte-table-actions-menu-open {
					display: block;
					animation: kyte-dropdown-fade-in 0.2s ease;
				}

				@keyframes kyte-dropdown-fade-in {
					from {
						opacity: 0;
						transform: translateY(-8px);
					}
					to {
						opacity: 1;
						transform: translateY(0);
					}
				}

				.kyte-table-actions-menu a {
					display: block;
					padding: 10px 16px;
					color: #4a5568;
					text-decoration: none;
					transition: background 0.2s;
				}

				.kyte-table-actions-menu a:hover {
					background: #f8fafc;
				}

				.kyte-table-actions-menu a i {
					width: 16px;
					margin-right: 8px;
					color: #a0aec0;
				}

				.kyte-table-actions-divider {
					height: 1px;
					background: #e2e8f0;
					margin: 4px 0;
				}

				.kyte-table-skeleton-row td {
					padding: 12px 16px;
				}

				.kyte-table-skeleton {
					height: 16px;
					background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
					background-size: 200% 100%;
					border-radius: 4px;
					animation: kyte-skeleton-loading 1.5s infinite;
				}

				@keyframes kyte-skeleton-loading {
					0% {
						background-position: 200% 0;
					}
					100% {
						background-position: -200% 0;
					}
				}

				.kyte-table-empty,
				.kyte-table-error {
					text-align: center;
					padding: 40px 20px;
					color: #a0aec0;
				}

				.kyte-table-empty i,
				.kyte-table-error i {
					display: block;
					font-size: 32px;
					margin-bottom: 12px;
					opacity: 0.5;
				}

				.kyte-table-error {
					color: #e53e3e;
				}

				.kyte-table-footer {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 16px 20px;
					background: #f8fafc;
					border-top: 1px solid #e2e8f0;
					border-radius: 0 0 8px 8px;
					position: relative;
					z-index: 0;
				}

				.kyte-table-page-size {
					display: flex;
					align-items: center;
					gap: 8px;
					font-size: 13px;
					color: #718096;
				}

				.kyte-table-page-size-select {
					padding: 6px 8px;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					font-size: 13px;
					background: white;
					cursor: pointer;
				}

				.kyte-table-page-buttons {
					display: flex;
					align-items: center;
					gap: 4px;
				}

				.kyte-table-page-btn {
					min-width: 32px;
					height: 32px;
					padding: 0 8px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					font-size: 13px;
					cursor: pointer;
					transition: all 0.2s;
				}

				.kyte-table-page-btn:hover:not(.disabled):not(.active) {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-page-btn.active {
					background: #ff6b35;
					border-color: #ff6b35;
					color: white;
				}

				.kyte-table-page-btn.disabled {
					opacity: 0.5;
					cursor: not-allowed;
				}

				.kyte-table-page-ellipsis {
					padding: 0 4px;
					color: #a0aec0;
				}

				/* Responsive */
				@media (max-width: 768px) {
					.kyte-table-toolbar {
						flex-direction: column;
						gap: 12px;
						align-items: flex-start;
					}

					.kyte-table-search-input {
						width: 100%;
					}

					.kyte-table-footer {
						flex-direction: column;
						gap: 12px;
						align-items: flex-start;
					}

					.kyte-table-page-buttons {
						width: 100%;
						justify-content: center;
					}
				}
			</style>
		`;$("head").append(e)};bindEdit=e=>{this.editForm=e};row=e=>{let t=$(e).closest("tr");return{data:()=>t.data("rowData"),node:()=>t[0],remove:()=>({draw:()=>this._loadData()})}};draw=()=>{this._loadData()};api=()=>({table:()=>({container:()=>this.container[0]})})}class KyteForm{constructor(e,t,a,i,s,l="Form",o=null,n=!1,d=null,r=null,c=null){this.api=e,this.model=a,this.modal=n,this.modalButton=d,this.KyteTable=o,this.title=l,this.hiddenFields=i,this.elements=s,this.id,this.submitButton="Submit",this.httpHeaders=[],this.fileUploadField=null,this.itemized=!1,this.externalChildData=!1,this.success=r,this.fail=c,this.loaded=!1,this.selector=t,this.selectedRow=null,this.editOnlyMode=!1,this.isValid=!0,this.validate=null}init=()=>{if(!this.loaded){this.id=this.makeID(8);let e="",t=this;this.modal&&(this.modalButton&&this.modalButton.on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#modal_"+t.model+"_"+t.id).modal("show")}),e+=`
<div class="modal fade" id="modal_${this.model}_${this.id}" tabindex="-1" role="dialog" aria-labelledby="modal_${this.model}_${this.id}" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header text-center">
				<h4 class="modal-title w-100 fw-bold">${this.title}</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body mx-3">`),e+=`
				<div id="${this.model}_${this.id}_modal-loader" class="modal" style="background: white; opacity: 0.6;" data-backdrop="static" data-keyboard="false" tabindex="-1">
					<div class="modal-dialog modal-sm h-100 d-flex">
						<div class="mx-auto align-self-center" style="width: 48px">
							<div class="spinner-wrapper text-center fa-6x"><span class="fas fa-sync fa-spin"></span></div>
						</div>
					</div>
				</div>
				<form novalidate="novalidate" class="needs-validation" id="form_${this.model}_${this.id}">
					<div class="error-msg"></div>`,this.hiddenFields&&this.hiddenFields.forEach(function(a){e+=`<input type="hidden" id="${void 0!==a.id?a.id:`form_${t.model}_${t.id}_${a.name}`}" name="${a.name}" value="${a.value}">`}),this.elements.forEach(function(a){e+='<div class="row my-2">',a.forEach(function(a){e+=`<div class="col-sm${void 0!==a.col?"-"+a.col:""}"><div class="form-group">`;let i=void 0!==a.id?a.id:`form_${t.model}_${t.id}_${a.field}`;if(a.label&&(e+=`<label for="${i}">${a.label}</label>`),"select"==a.type){if(e+=`<select id="${i}" class="form-select" name="${a.field}"${a.required?' required="required"':""}>`,a.placeholder&&(e+=`<option selected="selected" disabled>${a.placeholder}</option>`),!a.option.ajax)for(var s in a.option.data)a.option.data.hasOwnProperty(s)&&(e+=`<option value="${s}">${a.option.data[s]}</option>`);e+="</select>"}else"textarea"==a.type?e+=`<textarea style="width:100%" id="${i}" class="form-control" name="${a.field}"${a.required?' required="required"':""}${void 0!==a.placeholder?' placeholder="'+a.placeholder+'"':""} ${void 0!==a.maxlength?' maxlength="'+a.maxlength+'"':""}></textarea>`:"file"==a.type?(e+=`<input type="file" id="${i}" name="${a.field}" class="form-control" data-max-file-size="2M" accept="image/*;capture=camera"${a.required?' required="required"':""} />`,t.fileUploadField=i):e+=`<input type="${a.type}" id="${i}" class="form-control" name="${a.field}"${a.required?' required="required"':""}${void 0!==a.placeholder?' placeholder="'+a.placeholder+'"':""}${void 0!==a.value?' value="'+a.value+'"':""}${void 0!==a.readonly?" readonly":""} ${void 0!==a.maxlength?' maxlength="'+a.maxlength+'"':""}/>`;"function"==typeof a.click&&$("body").on("click",`#${i}`,function(e){a.click(t,$(`#${i}`),e)}),"function"==typeof a.change&&$("body").on("change",`#${i}`,function(e){a.change(t,$(`#${i}`),e)}),e+="</div></div>"}),e+="</div>"}),this.itemized&&(e+=`<hr><h6>${this.itemized.title}</h6><div class="row">`,this.itemized.fields.forEach(function(t){e+=`<div class="col">${t.label}</div>`}),e+=`<div class="col"></div></div><div id="itemized_${this.model}_${this.id}"></div><div class="row my-4"><div class="col text-end"><a href="#" class="itemized-add-item btn btn-sm btn-outline-secondary">Add</a></div></div><hr>`),e+=`<div class="row my-4"><div class="col text-center"><input type="submit" name="submit" value="${t.submitButton}" class="btn btn-primary btn-medium d-sm-inline-block"></div></div>`,e+="</form>",this.modal&&(e+="</div></div></div></div>"),"string"==typeof this.selector&&($("body").append(`<div id="${this.selector}"></div>`),this.selector=$(this.selector)),this.selector.append(e),this.reloadAjax(),$(`#form_${this.model}_${this.id}`).submit(function(e){var a=$(this);if(e.preventDefault(),t.isValid=!0,a.find("input").each(function(){$(this).prop("required")&&!$(this).val()?(t.isValid=!1,$(this).addClass("is-invalid"),$(this).removeClass("is-valid")):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"))}),a.find("textarea").each(function(){$(this).prop("required")&&!$(this).val()?(t.isValid=!1,$(this).addClass("is-invalid"),$(this).removeClass("is-valid")):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"))}),"function"==typeof t.validate&&t.validate(t),t.isValid){$("#"+t.model+"_"+t.id+"_modal-loader").modal("show");let i=t.editOnlyMode?t.editOnlyMode:a.data("idx");if(i>0)t.api.put(t.model,"id",i,null,a.serialize(),t.httpHeaders,function(e){$("#"+t.model+"_"+t.id+"_modal-loader").modal("hide"),"function"==typeof t.success&&t.success(e),t.KyteTable&&1==e.data.length&&t.selectedRow.data(e.data[0]).draw(),$(`#form_${t.model}_${t.id}`).trigger("reset"),t.hideModal()},function(e){$("#"+t.model+"_"+t.id+"_modal-loader").modal("hide"),t.appendErrorMessage(e),"function"==typeof t.success&&t.fail(e)});else{if(t.fileUploadField){let s=document.getElementById(t.fileUploadField).files[0];s&&a.append(`<input id="filename" type="hidden" name="filename" value="${s.name}" />`)}t.api.post(t.model,null,a.serialize(),t.httpHeaders,function(e){if(t.KyteTable&&e.data.forEach(function(e){t.KyteTable.table.row.add(e).draw()}),t.fileUploadField&&e.data[0].s3endpoint){$("#filename").remove();let a=e.data[0].id,i=document.getElementById(t.fileUploadField).files[0],s=new FormData;s.append("acl","private"),s.append("key",e.data[0].key),s.append("policy",e.data[0].policy),s.append("x-amz-algorithm","AWS4-HMAC-SHA256"),s.append("x-amz-credential",e.data[0].credential),s.append("x-amz-date",e.data[0].date),s.append("x-amz-signature",e.data[0].signature),s.append("file",i),$.ajax({url:e.data[0].s3endpoint,type:"post",data:s,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(a){"function"==typeof t.success&&t.success(e),$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),$(`#form_${t.model}_${t.id}`).trigger("reset"),t.hideModal()},error:function(e){$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.appendErrorMessage(e),"function"==typeof t.fail&&t.fail(e),k.delete(t.model,"id",a,[])}})}else"function"==typeof t.success&&t.success(e),$(`#form_${t.model}_${t.id}`).trigger("reset"),$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.hideModal()},function(e){$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.appendErrorMessage(e),"function"==typeof t.fail&&t.fail(e)})}}}),this.modal&&($("#modal_"+this.model+"_"+this.id).on("hidden.bs.modal",function(e){if(e.target.id=="modal_"+t.model+"_"+t.id){var a=$(`#form_${t.model}_${t.id}`);a.data("idx",""),a.data("row",""),a.find(".error-msg").html(""),a.find("input").each(function(){$(this).removeClass("is-invalid"),$(this).removeClass("is-valid")}),a.find('input[type="text"').each(function(){$(this).val("")}),a.find('input[type="email"').each(function(){$(this).val("")}),a.find('input[type="password"').each(function(){$(this).val("")}),a.find('input[type="tel"').each(function(){$(this).val("")}),a.find('input[type="checkbox"').each(function(){$(this).prop("checked",!1)}),a.find('input[type="radio"').each(function(){$(this).prop("checked",!1)}),a.find("select").each(function(){$(this).prop("selectedIndex",0)}),a.find("textarea").each(function(){$(this).val("")}),t.itemized&&$("#itemized_"+t.model+"_"+t.id).html(""),$(`#form_${t.model}_${t.id}`).trigger("reset")}}),$("#modal_"+this.model+"_"+this.id).on("shown.bs.modal",function(e){if(e.target.id=="modal_"+t.model+"_"+t.id){var a=$(`#form_${t.model}_${t.id}`);let i=t.editOnlyMode?t.editOnlyMode:a.data("idx");i&&($(`#${t.model}_${t.id}_modal-loader`).modal("show"),t.loadFormData(i,function(){$(`#${t.model}_${t.id}_modal-loader`).modal("hide")},function(){$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.hideModal(),console.error("Unable to load form. Please try again later")}))}})),this.itemized&&($(`#form_${this.model}_${this.id}`).on("click",".itemized-add-item",function(e){var a=t.makeID(8);e.preventDefault();let i='<div class="row itemized-row my-3">';t.itemized.fields.forEach(function(e){if(i+='<div class="col"><div class="form-group">',"select"==e.type){if(i+=`<select id="${e.option.data_model_name}_${e.option.data_model_value}_${a}" id="itemized_${t.model}_${t.id}_${e.name}" class="form-select" name="${e.name}"${e.required?' required="required"':""}>`,!e.option.ajax)for(var s in e.option.data)e.option.data.hasOwnProperty(s)&&(i+=`<option value="${s}">${e.option.data[s]}</option>`);i+="</select>"}else"textarea"==e.type?i+=`<textarea style="width:100%" id="itemized_${t.model}_${t.id}_${e.name}" class="form-control" name="${e.name}"${e.required?' required="required"':""}${void 0!==e.placeholder?' placeholder="'+e.placeholder+'"':""}></textarea>`:i+=`<input type="${e.type}" id="itemized_${t.model}_${t.id}_${e.name}" class="form-control" name="${e.name}"${e.required?' required="required"':""}${void 0!==e.placeholder?' placeholder="'+e.placeholder+'"':""}${void 0!==e.readonly?" readonly":""}>`;i+="</div></div>"}),i+='<div class="col-2 text-end"><a href="#" class="itemized-delete-item btn btn-sm btn-outline-danger">remove</a></div></div>',$(`#itemized_${t.model}_${t.id}`).append(i),t.itemized.fields.forEach(function(e){"select"==e.type&&e.option.ajax&&t.api.get(e.option.data_model_name,e.option.data_model_field,e.option.data_model_value,[],function(t){t.data.forEach(function(t){let i="";e.option.data_model_attributes.forEach(function(e){if(t[e])i+=t[e]+" ";else{let a=e.split(".");a.length>=2?i+=t[a[0]][a[1]]+" ":i+=e+" "}}),$(`#${e.option.data_model_name}_${e.option.data_model_value}_${a}`).append(`<option value="${t.id}">${i}</option>`)})})})}),$(`#form_${this.model}_${this.id}`).on("click",".itemized-delete-item",function(e){e.preventDefault(),$(this).closest(".itemized-row").remove()})),this.loaded=!0}};appendErrorMessage=e=>{$(`#form_${this.model}_${this.id} .error-msg`).append(`<div class="alert alert-danger" role="alert">${e}</div>`)};clearErrorMessage=()=>{$(`#form_${this.model}_${this.id} .error-msg`).html("")};showModal=()=>{this.modal&&$(`#modal_${this.model}_${this.id}`).modal("show")};hideModal=()=>{this.modal&&$(`#modal_${this.model}_${this.id}`).modal("hide")};loadFormData=(e,t=null,a=null)=>{var i=this;i.externalChildData&&i.httpHeaders.push({name:"x-kyte-get-externaltables",value:"true"}),i.api.get(i.model,"id",e,i.httpHeaders,function(e){i.elements.forEach(function(t){t.forEach(function(t){let a=void 0!==t.id?t.id:`form_${i.model}_${i.id}_${t.field}`;if("object"==typeof e.data[0][t.field]&&null!==e.data[0][t.field])$(`#${a}`).val(e.data[0][t.field].id).change();else{if("date"===t.type){var s=e.data[0][t.field].replace(/\//g,"-");$(`#${a}`).val(s)}else $(`#${a}`).val(e.data[0][t.field]);$(`#${a}`).change()}})}),i.itemized&&(e.data[0].ExternalTables&&e.data[0].ExternalTables.LineItem?i.renderItemizedData(e.data[0].ExternalTables.LineItem):i.itemized.model&&i.itemized.foreign_key?i.api.get(i.itemized.model,i.itemized.foreign_key,e.data[0].id,i.httpHeaders,function(e){i.renderItemizedData(e.data)}):error.log("External tables or model+foreign key not defined. At least one must be defined for itemized forms")),"function"==typeof t&&t()},function(){"function"==typeof t&&t()})};renderItemizedData=e=>{var t=0,a=this;e.forEach(function(e){a.makeID(8);let i='<div class="row itemized-row my-3">';a.itemized.fields.forEach(function(s){var l=s.field?s.field:s.name.replace(/\[\]$/,""),o=a.api.getNestedValue(e,l);if(o=void 0===o?"":o,i+='<div class="col"><div class="form-group">',"select"==s.type){if(i+=`<select id="itemized_${a.model}_${a.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-select itemized_${a.model}_${a.id}_${s.name.replace(/\[\]$/,"")}" name="${s.name}" value="${o}" data-selected-value="${o}"${s.required?' required="required"':""}>`,!s.option.ajax)for(var l in s.option.data)s.option.data.hasOwnProperty(l)&&(i+=`<option value="${l}">${s.option.data[l]}</option>`);i+="</select>"}else"textarea"==s.type?i+=`<textarea style="width:100%" id="itemized_${a.model}_${a.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-control" name="${s.name}" value="${o}"${s.required?' required="required"':""}${void 0!==s.placeholder?' placeholder="'+s.placeholder+'"':""}></textarea>`:i+=`<input type="${s.type}" id="itemized_${a.model}_${a.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-control" name="${s.name}" value="${o=s.date?o.replace(/\//g,"-"):o}"${s.required?'required="required"':""}${void 0!==s.placeholder?' placeholder="'+s.placeholder+'"':""}${void 0!==s.readonly?" readonly":""}>`;i+="</div></div>"}),i+='<div class="col-2 text-end"><a href="#" class="itemized-delete-item btn btn-sm btn-outline-danger">remove</a></div></div>',$(`#itemized_${a.model}_${a.id}`).append(i),t++}),a.itemized.fields.forEach(function(e){"select"==e.type&&e.option.ajax&&a.api.get(e.option.data_model_name,e.option.data_model_field,e.option.data_model_value,[],function(t){t.data.forEach(function(t){let i="";e.option.data_model_attributes.forEach(function(e){if(t[e])i+=t[e]+" ";else{let a=e.split(".");a.length>=2?i+=t[a[0]][a[1]]+" ":i+=e+" "}});let s=e.option.data_model_default_field?e.option.data_model_default_field:"id";$(`.itemized_${a.model}_${a.id}_${e.name.replace(/\[\]$/,"")}`).append(`<option value="${t[s]}">${i}</option>`)}),$(`.itemized_${a.model}_${a.id}_${e.name.replace(/\[\]$/,"")}`).each(function(){let e=$(this).data("selected-value");$(this).val(e).trigger("change")})})})};reloadAjax=()=>{let e=this;this.elements.forEach(function(t){t.forEach(function(t){let a=void 0!==t.id?t.id:`form_${e.model}_${e.id}_${t.field}`;"select"==t.type&&t.option.ajax&&($(`#${a}`).html(""),t.placeholder&&$(`#${a}`).append(`<option selected="selected" disabled>${t.placeholder}</option>`),e.api.get(t.option.data_model_name,t.option.data_model_field,t.option.data_model_value,[],function(e){e.data.forEach(function(e){let i="";t.option.data_model_attributes.forEach(function(t){if(e[t])i+=e[t]+" ";else{let a=t.split(".");a.length>=2?i+=e[a[0]][a[1]]+" ":i+=t+" "}});let s=t.option.data_model_default_field?t.option.data_model_default_field:"id";$(`#${a}`).append(`<option value="${e[s]}"${e[s]==t.option.data_model_default_value?' selected="selected"':""}>${i}</option>`)})},function(){console.error(`Unable to load form dropdown data for ${t.option.data_model_name}`)}))})})};setID=e=>{$(`#form_${this.model}_${this.id}`).data("idx",e)};getID=()=>$(`#form_${this.model}_${this.id}`).data("idx");makeID=e=>{for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=a.length,s=0;s<e;s++)t+=a.charAt(Math.floor(Math.random()*i));return t}}class KyteCalendar{constructor(e){this.selector=e,this.Days=["Su","Mo","Tu","We","Th","Fr","Sa"],this.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.selectedDate=null,this.selectedEndDate=null,this.callback=null,this.date=new Date,this.rowMonths=1,this.colMonths=0,this.selectedActiveClass="calendar-date-active",this.selectedEndActiveClass="calendar-date-active",this.fieldInFocus=null}init=()=>{let e=this,t='<div class="kyte-calendar">';this.colMonths=$(this.selector).data("colMonths"),this.rowMonths=$(this.selector).data("rowMonths"),t+='<div class="d-flex justify-content-between mb-2"><a href="#" class="calendar-back"><i class="fas fa-arrow-alt-circle-left fa-3x"></i></a><a href="#" class="calendar-forward"><i class="fas fa-arrow-alt-circle-right fa-3x"></i></a></div>',t+='<div class="row kyte-calendar-row">',t+=this.generateRow(function(e,t){return 0==e&&0==t?0:1}),t+="</div></div>",$(this.selector).html(t),$(".kyte-calendar").on("click",".calendar-forward",function(t){t.preventDefault(),t.stopPropagation(),e.date.setMonth(e.date.getMonth()+e.colMonths*e.rowMonths*2),$(".kyte-calendar-row").html(e.generateRow())}),$(".kyte-calendar").on("click",".calendar-back",function(t){t.preventDefault(),t.stopPropagation(),$(".kyte-calendar-row").html(e.generateRow())}),$(".kyte-calendar").on("click",".calendar-date-content",function(t){t.preventDefault(),t.stopPropagation();let a=$(this).data("calendarYear"),i=$(this).data("calendarMonth"),s=$(this).data("calendarDate");$(".calendar-date-content").removeClass(e.selectedActiveClass),$(".calendar-date-content").removeClass(e.selectedEndActiveClass);let l=new Date(a,i,s);"range"==$(e.selector).data("selectionType")?e.fieldInFocus?(console.log("test"),console.log(e.fieldInFocus.data("date-target")),"start"==e.fieldInFocus.data("date-target")?(e.selectedDate=l,e.selectedDate>e.selectedEndDate&&(e.selectedEndDate=null)):(e.selectedEndDate=l,e.selectedDate>e.selectedEndDate&&(e.selectedDate=null)),e.fieldInFocus=null):null==e.selectedDate?e.selectedDate=l:e.selectedDate>l?(e.selectedDate=l,e.selectedEndDate=null):null==e.selectedEndDate?e.selectedEndDate=l:(e.selectedDate=l,e.selectedEndDate=null):e.selectedDate=new Date(a,i,s),null!=e.selectedEndDate&&$(".calendar-element-"+e.selectedEndDate.getFullYear()+"-"+e.selectedEndDate.getMonth()+"-"+e.selectedEndDate.getDate()).addClass(e.selectedEndActiveClass),null!=e.selectedDate&&$(".calendar-element-"+e.selectedDate.getFullYear()+"-"+e.selectedDate.getMonth()+"-"+e.selectedDate.getDate()).addClass(e.selectedActiveClass),"function"==typeof e.callback&&e.callback(e.selectedDate,e.selectedEndDate)})};updateSelectedDate=e=>{if(null==e||""==e)this.selectedDate=null;else{let t=new Date(e);this.selectedDate=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),this.selectedDate>this.selectedEndDate&&(this.selectedEndDate=null)}this.fieldInFocus=null,this.redraw()};updateSelectedEndDate=e=>{if(null==e||""==e)this.selectedEndDate=null;else{let t=new Date(e);this.selectedEndDate=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),this.selectedEndDate<this.selectedDate&&(this.selectedDate=null)}this.fieldInFocus=null,this.redraw()};redraw=()=>{this.date.setMonth(this.date.getMonth()+this.colMonths*this.rowMonths),$(".kyte-calendar-row").html(this.generateRow())};generateRow=e=>{if(this.rowMonths<1||this.rowMonths>3){console.error("Invalid option for number of rows to display. Please pick between 1 and 3.");return}if(this.colMonths<1||this.colMonths>3){console.error("Invalid option for number of months to display per col. Please pick between 1 and 3.");return}if("function"==typeof e){if(!Number.isInteger(e(1))){console.error("Modifier does not return an integer. Must return an integer.");return}}else e=function(e){return 1};let t="";this.rowMonths>1&&(t+='<div class="col">');let a=[];for(let i=0;i<this.rowMonths;i++){let s="";this.rowMonths>1&&(s+='<div class="row mb-2">');let l=[];for(let o=0;o<this.colMonths;o++){this.date.setMonth(this.date.getMonth()-e(o,i));let n=this.generateCalendar(this.date);l.push('<div class="col-lg-'+12/this.colMonths+' mb-2 mb-lg-0 px-1">'+n+"</div>")}s+=l.reverse().join(""),this.rowMonths>1&&(s+="</div>"),a.push(s)}return t+=a.reverse().join(""),this.rowMonths>1&&(t+="</div>"),t};generateCalendar=e=>{let t=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),a=new Date(e.getFullYear(),e.getMonth(),1),i=[],s=[],l=0;for(i.push('<div class="row"><div class="col"><div class="calendar-month-label">'+this.Months[e.getMonth()]+" "+e.getFullYear()+"</div></div></div>");l<7;l++)s.push('<div class="col"><div class="calendar-day-of-week">'+this.Days[l]+"</div></div>");i.push('<div class="row">'+s.join("")+"</div>"),s=[],l=0;let o=a.getDay();for(;l<o;l++)s.push('<div class="col"><div class="calendar-date-square"></div></div>');for(let n=1;n<=t;n++){a.setDate(n);let d=!1,r=!1;this.selectedDate&&this.selectedDate.getTime()===a.getTime()&&(d=!0),this.selectedEndDate&&this.selectedEndDate.getTime()===a.getTime()&&(r=!0),l%7==0&&(i.push('<div class="row">'+s.join("")+"</div>"),s=[],l=0),s.push('<div class="col"><div class="calendar-date-square"><a href="#" data-calendar-month="'+e.getMonth()+'" data-calendar-year="'+e.getFullYear()+'" data-calendar-date="'+n+'" data-calendar-day="'+this.Days[l]+'" class="'+(d?this.selectedActiveClass+" ":"")+(r?this.selectedEndActiveClass+" ":"")+"calendar-date-content calendar-element-"+e.getFullYear()+"-"+e.getMonth()+"-"+n+' align-items-center justify-content-center d-flex"><span class="d-flex-column">'+n+"</span></a></div></div>"),l++}for(;l<7;l++)s.push('<div class="col"><div class="calendar-date-square"></div></div>');return i.push('<div class="row">'+s.join("")+"</div>"),'<div class="kyte-calendar-wrapper">'+i.join("")+"</div>"}}class KytePasswordRequirement{constructor(e,t,a,i){this.api=e,this.selector=t,this.passwordField=a,this.confirmField=i,this.minLength=8,this.lengthText="Minimum length of "+this.minLength,this.lowerCaseText="At least one lower case letter",this.upperCaseText="At least one upper case letter",this.numberText="At least one number",this.symbolText="At least one symbol",this.reqLength=!0,this.reqLowerCase=!0,this.reqUpperCase=!0,this.reqNumber=!0,this.reqSymbol=!0,this.valid=!1}init=()=>{let e=this;this.selector.html("");let t='<ul class="fa-ul">';this.reqLength&&(t+='<li class="validate-length"><i class="fa-li far fa-circle"></i> '+this.lengthText+"</li>"),this.reqLowerCase&&(t+='<li class="validate-small"><i class="fa-li far fa-circle"></i> '+this.lowerCaseText+"</li>"),this.reqUpperCase&&(t+='<li class="validate-large"><i class="fa-li far fa-circle"></i> '+this.upperCaseText+"</li>"),this.reqNumber&&(t+='<li class="validate-number"><i class="fa-li far fa-circle"></i> '+this.numberText+"</li>"),this.reqSymbol&&(t+='<li class="validate-symbol"><i class="fa-li far fa-circle"></i> '+this.symbolText+"</li>"),t+="</ul>",this.selector.append(t),this.passwordField.on("keyup",function(){this.valid=e.validatePassword()})};validatePassword=()=>{var e=this.passwordField.val();let t=!0;return e||(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-length i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-small i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-large i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-number i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-symbol i").removeClass("text-success").addClass("text-danger"),t=!1),this.reqLength&&(e.length<8?(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-length i").removeClass("text-success").addClass("text-danger"),t=!1):(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-length i").removeClass("text-danger").addClass("text-success"))),this.reqLowerCase&&(e.match(/[a-z]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-small i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-small i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqUpperCase&&(e.match(/[A-Z]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-large i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-large i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqNumber&&(e.match(/\d/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-number i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-number i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqSymbol&&(e.match(/[@$!%*#?&]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-symbol i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-symbol i").removeClass("text-success").addClass("text-danger"),t=!1)),t}}class KyteWebComponent{constructor(e){if("object"!=typeof e||null===e)throw Error("Components must be an object");this.components=e}bind=(e,t,a,i=null)=>{let s=$(e);if(0===s.length){console.warn(`No element found for selector: ${e}`);return}if(!this.components.hasOwnProperty(t)){console.warn(`Template identifier "${t}" not found.`);return}if(!Array.isArray(a)){console.warn("Data must be an array.");return}let l=this.components[t];s.html(""),a.forEach(e=>{"function"==typeof i&&i(e);let t=this.replacePlaceholders(l,e);s.append(t)})};replacePlaceholders=(e,t)=>e.replace(/{{\s*(\w+)\s*}}/g,(e,a)=>t.hasOwnProperty(a)?t[a]:"")}
