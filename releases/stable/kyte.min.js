/**
    * Copyright 2020-2026 KeyQ, Inc.
    * 
    * This source file is free software,
    * available under the following license:
    * MIT license
    * 
    * This source file is distributed in the hope that
    * it will be useful, but WITHOUT ANY WARRANTY;
    * without even the implied warranty of MERCHANTABILITY
    * or FITNESS FOR A PARTICULAR PURPOSE.
    * See the license files for details.
    * 
    * For details please refer to: http://www.keyq.cloud
    * KyteJS
    * ©2020-2026 KeyQ, Inc.
    **/
class Kyte{static VERSION="1.4.0";constructor(e,t,i,a,s=null){this.url=e,this.access_key=t,this.identifier=i,this.account_number=a,this.applicationId=s,this.initial_access_key=t,this.initial_identifier=i,this.initial_account_number=a,this.txToken,this.sessionToken,this.dateFormat="mm/dd/yy",this.sessionCrossDomain=!1,this.sessionTimer=null,this.redirectToLoginInitiated=!1,this.sessionController="Session"}init=()=>{this.access_key=this.getCookie("kyte_pub")?this.getCookie("kyte_pub"):this.access_key,this.identifier=this.getCookie("kyte_iden")?this.getCookie("kyte_iden"):this.identifier,this.account_number=this.getCookie("kyte_num")?this.getCookie("kyte_num"):this.account_number,this.txToken=this.getCookie("txToken")?this.getCookie("txToken"):0,this.sessionToken=this.getCookie("sessionToken")?this.getCookie("sessionToken"):0,console.info(`Initialized KyteJS v${Kyte.VERSION}`)};apiVersion=(e,t=null)=>{var i=this;$.ajax({method:"GET",crossDomain:!0,dataType:"json",url:i.url,success:function(t){"function"==typeof e?e(t.engine_version,t.framework_version):console.log("Engine: "+t.engine_version+"; Framework: "+t.framework_version)},error:function(e){"function"==typeof t?t(e.responseJSON.error):console.error(e.responseJSON.error)}})};sign=(e,t=null)=>{var i=new Date,a=this;$.ajax({method:"POST",crossDomain:!0,dataType:"json",url:a.url,data:"key="+a.access_key+"&identifier="+a.identifier+"&token="+a.txToken+"&time="+i.toUTCString(),success:function(t){"function"==typeof e?e(t,i):console.log(t)},error:function(e){"function"==typeof t?t(e):console.error(e)}})};sendData=(e,t,i=null,a=null,s=null,l=null,o=[],n,r=null)=>{var d=this;this.sign(function(c,h){let u=encodeURIComponent(btoa(d.access_key+"%"+d.sessionToken+"%"+h.toUTCString()+"%"+d.account_number));var p=d.url+"/"+t;i&&(p+="/"+encodeURIComponent(i)),a&&(p+="/"+encodeURIComponent(a));var m="";s&&(m+=$.param(s)),l&&(m&&(m+="&"),m+=l),$.ajax({method:e,crossDomain:!0,dataType:"json",url:p,beforeSend:function(e){if(e.setRequestHeader("x-kyte-signature",c.signature),e.setRequestHeader("x-kyte-identity",u),d.applicationId&&e.setRequestHeader("x-kyte-appid",d.applicationId),e.setRequestHeader("x-kyte-device",window.navigator.userAgent),o.length>0)for(let t of o)e.setRequestHeader(t.name,t.value)},data:m,success:function(e){e.syntax_error&&d.syntaxErrorBanner(e.syntax_error),d.txToken=e.token,d.sessionToken=e.session,e.kyte_pub&&e.kyte_iden&&e.kyte_num?(d.access_key=e.kyte_pub,d.identifier=e.kyte_iden,d.account_number=e.kyte_num,d.setCookie("kyte_pub",d.access_key,60,d.sessionCrossDomain),d.setCookie("kyte_iden",d.identifier,60,d.sessionCrossDomain),d.setCookie("kyte_num",d.account_number,60,d.sessionCrossDomain)):(d.setCookie("kyte_pub","",-1),d.setCookie("kyte_num","",-1),d.setCookie("kyte_iden","",-1),d.access_key=d.initial_access_key,d.identifier=d.initial_identifier,d.account_number=d.initial_account_number),e.token||e.session?(d.setCookie("txToken",d.txToken,60,d.sessionCrossDomain),d.setCookie("sessionToken",d.sessionToken,60,d.sessionCrossDomain),d.setCookie("accountIdx",e.account_id,60,d.sessionCrossDomain),d.setCookie("roleIdx",e.role?e.role.id:0,60,d.sessionCrossDomain),d.setCookie("roleName",e.role?e.role.name:null,60,d.sessionCrossDomain)):d.sessionDestroy(),"function"==typeof n?n(e):console.log(e)},error:function(e){e.syntax_error&&d.syntaxErrorBanner(e.syntax_error),403==e.status?(d.sessionDestroy(),d.sessionTimer&&clearInterval(d.sessionTimer),t!=d.sessionController&&d.redirectToLogin()):null!=e.responseJSON&&(d.txToken=e.responseJSON.token,d.sessionToken=e.responseJSON.session,e.kyte_pub&&e.kyte_iden&&e.kyte_num?(d.access_key=e.kyte_pub,d.identifier=e.kyte_iden,d.account_number=e.kyte_num,d.setCookie("kyte_pub",d.access_key,60,d.sessionCrossDomain),d.setCookie("kyte_iden",d.identifier,60),d.sessionCrossDomain,d.setCookie("kyte_num",d.account_number,60,d.sessionCrossDomain)):(d.setCookie("kyte_pub","",-1),d.setCookie("kyte_num","",-1),d.setCookie("kyte_iden","",-1),d.access_key=d.initial_access_key,d.identifier=d.initial_identifier,d.account_number=d.initial_account_number),e.responseJSON.token||e.responseJSON.session?(d.setCookie("txToken",d.txToken,60,d.sessionCrossDomain),d.setCookie("sessionToken",d.sessionToken,60,d.sessionCrossDomain),d.setCookie("accountIdx",e.account_id,60,d.sessionCrossDomain),d.setCookie("roleIdx",e.role?e.role.id:0,60,d.sessionCrossDomain),d.setCookie("roleName",e.role?e.role.name:null,60,d.sessionCrossDomain)):d.sessionDestroy()),null==e.responseJSON?console.log(e):"function"==typeof r?r(e.responseJSON.error):console.error(e.responseJSON.error)}})},function(e){null==e.responseJSON?console.error(e):"function"==typeof r?r(e):console.error(e)})};post=(e,t=null,i=null,a=[],s,l=null)=>{this.sendData("POST",e,null,null,t,i,a,s,l)};put=(e,t=null,i=null,a=null,s=null,l=[],o,n=null)=>{this.sendData("PUT",e,t,i,a,s,l,o,n)};get=(e,t=null,i=null,a=[],s,l=null)=>{this.sendData("GET",e,t,i,null,null,a,s,l)};delete=(e,t=null,i=null,a=[],s,l=null)=>{this.sendData("DELETE",e,t,i,null,null,a,s,l)};setCookie=(e,t,i=null,a=!1)=>{var s="";if(i){var l=new Date;l.setTime(l.getTime()+6e4*i),s=";expires="+l.toUTCString()}let o=window.location.hostname.split("."),n="";a&&(o.length>2?n="domain="+o.slice(1).join(".")+";":2==o.length&&(n="domain="+o.joing(".")+";")),document.cookie=e+"="+t+s+";path=/;"+n+("https:"===location.protocol?"secure;":"")};getCookie=e=>{for(var t=e+"=",i=document.cookie.split(";"),a=0;a<i.length;a++){for(var s=i[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null};getUrlHash=()=>location.hash;getUrlParameter=e=>{var t,i,a,s=window.location.search.substring(1).split("&");for(i=0;i<s.length;i++)if((t=s[i].split("="))[0]===e)return void 0!==t[1]&&decodeURIComponent(t[1]);return!1};getPageRequest=()=>{let e=this.getUrlParameter("request");return e?JSON.parse(decodeURIComponent(atob(e))):null};setPageRequest=(e,t)=>{let i;return encodeURIComponent(btoa(JSON.stringify({model:e,value:t})))};initSpinner=e=>{e.append('<div id="pageLoaderModal" class="modal" style="background: white; opacity: 0.6;" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"><div class="modal-dialog modal-sm h-100 d-flex"><div class="mx-auto align-self-center" style="width: 48px"><div class="spinner-wrapper text-center fa-6x"><span class="fas fa-sync fa-spin"></span></div></div></div></div>')};startSpinner=()=>{$("#pageLoaderModal").modal()};stopSpinner=()=>{$("#pageLoaderModal").modal("hide")};sessionCreate=(e,t,i=null,a=null)=>{var s=this;null!==a&&(s.sessionController=a),this.post(s.sessionController,e,null,[],function(e){s.txToken=e.token,s.sessionToken=e.session,s.setCookie("txToken",s.txToken,60,s.sessionCrossDomain),s.setCookie("sessionToken",s.sessionToken,60,s.sessionCrossDomain),s.setCookie("accountIdx",e.account_id,60,s.sessionCrossDomain),s.setCookie("roleIdx",e.role?e.role.id:0,60,s.sessionCrossDomain),s.setCookie("roleName",e.role?e.role.name:null,60,s.sessionCrossDomain),s.access_key=e.kyte_pub,s.identifier=e.kyte_iden,s.account_number=e.kyte_num,s.setCookie("kyte_pub",s.access_key,60,s.sessionCrossDomain),s.setCookie("kyte_iden",s.identifier,60,s.sessionCrossDomain),s.setCookie("kyte_num",s.account_number,60,s.sessionCrossDomain),"function"==typeof t?t(e):console.log(e)},function(e){s.sessionDestroy(),"function"==typeof i?i(e):console.error(e)})};addLogoutHandler=e=>{self=this,$("body").on("click",e,function(){self.sessionDestroy(function(){location.href="/"})})};checkSession=()=>(this.sessionToken&&"0"!==this.sessionToken&&this.txToken&&"0"!==this.txToken||this.sessionDestroy(),!!this.getCookie("sessionToken"));redirectToLogin=()=>{if(!this.redirectToLoginInitiated){this.redirectToLoginInitiated=!0,this.stopSpinner();let e=this;this.alert("Please sign in again","You were signed out of your account.  Please press 'OK' to sign in to your account again.",function(){var t=window.location.href;e.redirectToLoginInitiated=!1,window.location.href="/?redir="+encodeURIComponent(t)},!1)}};isSession=(e=!0,t=!0,i=3e4)=>{let a=this,s=this.checkSession();return s&&e&&(this.sessionTimer=setInterval(function(){!a.checkSession()&&(clearInterval(a.sessionTimer),t&&a.redirectToLogin())},i)),s};sessionDestroy=(e=null)=>{var t=this;this.delete("Session",null,null,[],function(t){"function"==typeof e?e(t):console.error(t)},function(t){"function"==typeof e?e(t):console.error(t)}),t.setCookie("txToken","",-1),t.setCookie("sessionToken","",-1),t.setCookie("accountIdx","",-1),t.setCookie("roleIdx","",-1),t.setCookie("roleName","",-1),t.setCookie("kyte_pub","",-1),t.setCookie("kyte_num","",-1),t.setCookie("kyte_iden","",-1),t.access_key=t.initial_access_key,t.identifier=t.initial_identifier,t.account_number=t.initial_account_number,t.sessionToken=0,t.txToken=0};makeid=e=>{for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*a));return t};alert=(e,t,i=null,a=!0)=>{this.makeid(5),$("<div></div>").appendTo("body").html("<div><h6>"+t+"</h6></div>").dialog({modal:!0,title:e,zIndex:1e4,autoOpen:!0,width:"auto",resizable:!1,closeOnEscape:a,open:function(e,t){a||$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){"function"==typeof i&&i(),$(this).dialog("close")}},close:function(e,t){$(this).remove()}})};confirm=(e,t,i=null,a=null)=>{this.makeid(5),$("<div></div>").appendTo("body").html("<div><h6>"+t+"</h6></div>").dialog({modal:!0,title:e,zIndex:1e4,autoOpen:!0,width:"auto",resizeable:!1,buttons:[{class:"btn btn-danger btn-delete-confirm-yes",text:"Yes",click:function(){"function"==typeof i&&i(),$(this).dialog("close")}},{class:"btn btn-secondary btn-delete-confirm-no",text:"No",click:function(){"function"==typeof a&&a(),$(this).dialog("close")}}],close:function(e,t){$(this).remove()}})};validateForm=e=>{let t=!0;return e.find("input").each(function(){$(this).prop("required")&&!$(this).val()&&(t=!1)}),t};syntaxErrorBanner=e=>{$("body").prepend('<div class="card text-white bg-danger m-3"><div class="card-header">Syntax Error</div><div class="card-body"><p class="card-text">'+e+"</p></div></div>")};getNestedValue=(e,t)=>t.split(".").reduce((e,t)=>e?e[t]:void 0,e)}class KyteNav{constructor(e,t,i=null,a=null,s=null,l="/app/"){this.selector=e,this.nav_struct=t,this.logo=i,this.title=a,this.active=s,this.link=l}create=()=>{let e='		<div class="container-fluid">			<a href="'+this.link+'" class="navbar-brand">'+(this.logo?'<img src="'+this.logo+'" style="height: 45px;" class="me-2 rounded">':"")+(this.title?this.title:"")+'</a>			<button data-bs-toggle="collapse" class="navbar-toggler" type="button" data-bs-target="#navcol-1" aria-controls="#navcol-1" aria-expanded="false" aria-label="Toggle navigation">				<span class="navbar-toggler-icon"></span>			</button>			<div class="collapse navbar-collapse" id="navcol-1">',t=0;this.nav_struct.forEach(i=>{e+=0==t?'<ul class="navbar-nav mx-auto">':'<ul class="navbar-nav">',t++,i.forEach(t=>{t.dropdown?(e+=`
					<li class="nav-item dropdown">
						<a id="${t.id?t.id:""}" class="nav-link dropdown-toggle ${t.class}" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">${t.faicon?'<i class="'+t.faicon+' me-2"></i>':""}<span>${t.label}</span></a>
						<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">`,t.items.forEach(t=>{e+=`<li><a id="${t.id?t.id:""}" class="dropdown-item ${t.class}${t.logout?" logout":""}" ${t.href?'href="'+t.href+'"':'href="#"'}>${t.faicon?'<i class="'+t.faicon+' me-2"></i>':""}<span>${t.label}</span></a></li>`}),e+="</ul></li>"):e+=`<li class="nav-item"><a id="${t.id?t.id:""}" class="nav-link${t.logout?" logout":""}${t.labelCenterBlock?" text-center p-0 my-1 mx-0":""}${t.label==this.active?" active":""} ${t.class}" ${t.href?'href="'+t.href+'"':'href="#"'}>${t.faicon?'<i class="'+t.faicon+(t.labelCenterBlock?" d-block":" me-2")+'"></i>':""}<span>${t.label}</span></a></li>`}),e+="</ul>"}),e+="			</div>		</div>",$(this.selector).html(e)}}class KyteSidenav{constructor(e,t,i){this.selector=e,this.nav_struct=t,this.default_page_selector=i}create=()=>{if($(this.selector).length){let e='<ul class="nav nav-pills flex-column mb-auto" id="sidebar-nav">';this.nav_struct.forEach(t=>{($(t.selector).length||t.href||t.logout)&&(e+='<li class="nav-item">',e+=`<a ${$(t.selector).length?'id="'+t.selector.replace("#","")+'-nav-link" ':t.id?'id="'+t.id+'"':""} ${'href="'+(t.logout?"#":t.href?t.href:t.selector)+'"'} class="nav-link ${t.class?t.class:""} ${t.labelCenterBlock?" text-center p-0 my-1 mx-0":""} ${t.logout?"logout":""}"><i class="${t.faicon}${t.labelCenterBlock?" d-block":" me-2"}"></i><span>${t.label}</span></a>`,e+="</li>")}),e+="</ul>",$(this.selector).html(e)}};bind=(e=null)=>{let t=this,i=location.hash;$(i=""==i?this.default_page_selector:i).removeClass("d-none"),$(i+"-nav-link").addClass("active"),this.nav_struct.forEach(i=>{$(i.selector+"-nav-link").click(function(a){history.pushState({},"",this.href),a.preventDefault(),$(i.selector+"-nav-link").addClass("active"),$(i.selector).removeClass("d-none"),"function"==typeof e&&e(i),t.nav_struct.forEach(e=>{e.selector!=i.selector&&($(e.selector+"-nav-link").removeClass("active"),$(e.selector).addClass("d-none"))})})})}}class KyteTable{constructor(e,t,i,a,s=!0,l=[],o=!1,n=!1,r=!1,d=null,c=null,h=null){this.api=e,this.model=i,this.httpHeaders=[],this.loaded=!1,this.table=null,this.selector=t,this.lang="https://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/English.json",this.searching=s,this.columnDefs=a,this.order=l,this.actionEdit=o,this.editForm=null,this.actionDelete=n,this.actionView=r,this.viewTarget=d,this.targetBlank=!1,this.rowCallBack=c,this.initComplete=h,this.processing=!0,this.serverside=!0,this.customAction=null,this.customActionButton=null,this.deleteDisplayHook=null,this.editDisplayHook=null,this.page_idx=1,this.pageLength=50,this.data=[],this.totalRecords=0,this.filteredRecords=0,this.currentPage=1,this.searchValue="",this.sortColumn=null,this.sortDirection="asc",this.isLoading=!1,this.drawCount=0,this.container=null,this.tableElement=null,this.searchInput=null,this.paginationContainer=null}init=()=>{if(!this.loaded){if(this.order&&this.order.length>0){let e=this.order[0][0];e<this.columnDefs.length&&this.columnDefs[e]&&this.columnDefs[e].data&&(this.sortColumn=this.columnDefs[e].data,this.sortDirection=this.order[0][1])}this._buildTableStructure(),this._bindEvents(),this._loadData(),this.loaded=!0,"function"==typeof this.initComplete&&setTimeout(()=>this.initComplete(),100)}};_buildTableStructure=()=>{if(this.selector.empty(),this._injectStyles(),this.container=$('<div class="kyte-table-container"></div>'),this.selector.append(this.container),this.searching){let e=$(`
				<div class="kyte-table-toolbar">
					<div class="kyte-table-search">
						<i class="fas fa-search"></i>
						<input type="text" placeholder="Search..." class="kyte-table-search-input" />
						<button class="kyte-table-search-clear" style="display:none;">
							<i class="fas fa-times"></i>
						</button>
					</div>
					<div class="kyte-table-info">
						<span class="kyte-table-record-count">Loading...</span>
					</div>
				</div>
			`);this.container.append(e),this.searchInput=e.find(".kyte-table-search-input")}let t=$('<div class="kyte-table-wrapper"></div>');this.container.append(t),this.tableElement=$('<table class="kyte-table"></table>'),t.append(this.tableElement);let i=$("<thead></thead>"),a=$("<tr></tr>");this.columnDefs.forEach((e,t)=>{let i=$(`
				<th class="kyte-table-th ${e.data.replace(/\./g,"_")}" data-column="${e.data}">
					<div class="kyte-table-th-content">
						<span class="kyte-table-th-label">${e.label||e.data}</span>
						${!1!==e.sortable?'<span class="kyte-table-sort-indicator"></span>':""}
					</div>
				</th>
			`);!1!==e.sortable&&i.addClass("kyte-table-sortable"),a.append(i)}),(this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0||this.customActionButton&&this.customActionButton.length>0)&&a.append('<th class="kyte-table-th kyte-table-actions-header"></th>'),i.append(a),this.tableElement.append(i);let s=$('<tbody class="kyte-table-body"></tbody>');this.tableElement.append(s);let l=$(`
			<div class="kyte-table-footer">
				<div class="kyte-table-page-size">
					<label>
						Show
						<select class="kyte-table-page-size-select">
							<option value="10">10</option>
							<option value="25">25</option>
							<option value="50" selected>50</option>
							<option value="100">100</option>
						</select>
						entries
					</label>
				</div>
				<div class="kyte-table-pagination"></div>
			</div>
		`);this.container.append(l),this.paginationContainer=l.find(".kyte-table-pagination"),this.actionView&&s.addClass("kyte-table-clickable")};_bindEvents=()=>{let e=this;if(this.searchInput){let t;this.searchInput.on("input",function(){let i=$(this).val();clearTimeout(t),t=setTimeout(()=>{e.searchValue=i,e.currentPage=1,e._loadData();let t=$(this).siblings(".kyte-table-search-clear");i?t.show():t.hide()},300)}),this.container.find(".kyte-table-search-clear").on("click",function(){e.searchInput.val(""),e.searchValue="",e.currentPage=1,e._loadData(),$(this).hide()})}this.tableElement.find(".kyte-table-sortable").on("click",function(){let t=$(this).data("column");e.sortColumn===t?e.sortDirection="asc"===e.sortDirection?"desc":"asc":(e.sortColumn=t,e.sortDirection="asc"),e._updateSortIndicators(),e._loadData()}),this.container.find(".kyte-table-page-size-select").on("change",function(){e.pageLength=parseInt($(this).val()),e.currentPage=1,e._loadData()}),this.actionDelete&&this.tableElement.on("click",".kyte-table-action-delete",function(t){t.stopPropagation(),t.preventDefault();let i=$(this).closest("tr").data("rowData");e.api.confirm("Delete","Are you sure you wish to delete?",function(){e.api.delete(e.model.name,"id",i.id,e.httpHeaders,function(){e._loadData()},function(){e.api.alert("Error","Unable to delete. Please try again later.")})})}),this.actionEdit&&this.tableElement.on("click",".kyte-table-action-edit",function(t){if(t.stopPropagation(),t.preventDefault(),e.editForm){let i=$(this).closest("tr").data("rowData"),a=$(this).closest("tr");e.editForm.selectedRow={data:()=>i,node:()=>a[0]},e.editForm.setID(i.id),e.editForm.showModal()}}),e.customAction&&e.customAction.length>0&&e.customAction.forEach(t=>{e.tableElement.on("click",".kyte-table-action-"+t.className,function(i){i.stopPropagation(),i.preventDefault();let a=$(this).closest("tr").data("rowData"),s=$(this).closest("tr");t.callback(a,e.model.name,{data:()=>a,node:()=>s[0]})})}),e.customActionButton&&e.customActionButton.length>0&&e.customActionButton.forEach(t=>{e.tableElement.on("click",".kyte-table-action-"+t.className,function(i){i.stopPropagation(),i.preventDefault();let a=$(this).closest("tr").data("rowData"),s=$(this).closest("tr");t.callback(a,e.model.name,{data:()=>a,node:()=>s[0]})})}),this.actionView&&this.tableElement.on("click","tbody tr",function(t){if($(t.target).closest(".kyte-table-actions").length>0)return;let i=$(this).data("rowData");if(e.viewTarget&&i){let a=e.api.getNestedValue(i,e.actionView),s={model:e.model.name,idx:a},l=encodeURIComponent(btoa(JSON.stringify(s)));e.targetBlank?window.open(e.viewTarget+"?request="+l,"_blank").focus():location.href=e.viewTarget+"?request="+l}})};_loadData=()=>{let e=this;if(this.isLoading)return;this.isLoading=!0,this.drawCount++,this._showSkeleton();let t=[];this.columnDefs.forEach(e=>{e.data&&t.push(e.data)});let i=[];i.push({name:"x-kyte-draw",value:this.drawCount}),i.push({name:"x-kyte-page-size",value:this.pageLength}),i.push({name:"x-kyte-page-idx",value:this.currentPage}),i.push({name:"x-kyte-page-search-value",value:this.searchValue?btoa(encodeURIComponent(this.searchValue)):""}),i.push({name:"x-kyte-page-search-fields",value:t.join(",")}),this.sortColumn&&(i.push({name:"x-kyte-page-order-col",value:this.sortColumn}),i.push({name:"x-kyte-page-order-dir",value:this.sortDirection}));let a=[...this.httpHeaders,...i];this.api.get(this.model.name,this.model.field,this.model.value,a,function(t){e.data=t.data||[],e.totalRecords=parseInt(t.total_count)||0,e.filteredRecords=parseInt(t.total_filtered)||0,e._renderData(),e._updatePagination(),e._updateRecordCount(),e.isLoading=!1},function(t){console.error(`Unable to load table data for ${e.model.name}`,t),e._showError(),e.isLoading=!1})};_showSkeleton=()=>{let e=this.tableElement.find("tbody");e.empty();let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0);for(let i=0;i<8;i++){let a=$('<tr class="kyte-table-skeleton-row"></tr>');for(let s=0;s<t;s++)a.append('<td><div class="kyte-table-skeleton"></div></td>');e.append(a)}};_showError=()=>{let e=this.tableElement.find("tbody");e.empty();let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0),i=$(`
			<tr class="kyte-table-error-row">
				<td colspan="${t}" class="kyte-table-error">
					<i class="fas fa-exclamation-triangle"></i>
					<span>Failed to load data. Please try again.</span>
				</td>
			</tr>
		`);e.append(i)};_renderData=()=>{let e=this.tableElement.find("tbody");if(e.empty(),0===this.data.length){let t=this.columnDefs.length+(this.actionEdit||this.actionDelete||this.customAction||this.customActionButton?1:0),i=$(`
				<tr class="kyte-table-empty-row">
					<td colspan="${t}" class="kyte-table-empty">
						<i class="fas fa-inbox"></i>
						<span>No data available</span>
					</td>
				</tr>
			`);e.append(i);return}this.data.forEach((t,i)=>{let a=$("<tr></tr>");if(a.data("rowData",t),this.columnDefs.forEach(e=>{let s=$("<td></td>"),l=this.api.getNestedValue(t,e.data);"function"==typeof e.render&&(l=e.render(l,"display",t,{row:i,col:e})),s.html(l),a.append(s)}),this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0||this.customActionButton&&this.customActionButton.length>0){let s=$('<td class="kyte-table-actions"></td>'),l="";if(this.customActionButton&&this.customActionButton.length>0&&this.customActionButton.forEach(e=>{e.className&&e.label&&"function"==typeof e.callback&&(l+=`<button class="kyte-table-action-btn kyte-table-action-${e.className}">${e.faicon?'<i class="'+e.faicon+'"></i> ':""}${e.label}</button>`)}),this.actionEdit||this.actionDelete||this.customAction&&this.customAction.length>0){let o='<div class="kyte-table-actions-dropdown"><button class="kyte-table-actions-toggle"><i class="fas fa-ellipsis-v"></i></button><div class="kyte-table-actions-menu">';if(this.actionEdit){let n='<a href="#" class="kyte-table-action-edit"><i class="fas fa-edit"></i> Edit</a>';"function"==typeof this.editDisplayHook&&(n=this.editDisplayHook(t,this.model.name,n)),o+=n}if(this.actionDelete){let r='<a href="#" class="kyte-table-action-delete"><i class="fas fa-trash-alt"></i> Delete</a>';"function"==typeof this.deleteDisplayHook&&(r=this.deleteDisplayHook(t,this.model.name,r)),o+=r}this.customAction&&this.customAction.length>0&&(o+='<div class="kyte-table-actions-divider"></div>',this.customAction.forEach(e=>{e.className&&e.label&&"function"==typeof e.callback&&(o+=`<a href="#" class="kyte-table-action-${e.className}">${e.faicon?'<i class="'+e.faicon+'"></i> ':""}${e.label}</a>`)})),o+="</div></div>",l+=o}s.html(l),a.append(s)}"function"==typeof this.rowCallBack&&this.rowCallBack(a[0],t,i),e.append(a)}),this._bindDropdownToggle()};_bindDropdownToggle=()=>{this.tableElement.find(".kyte-table-actions-toggle").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let t=$(this),i=t.next(".kyte-table-actions-menu"),a=t.closest(".kyte-table-actions");$(".kyte-table-actions-menu").not(i).removeClass("kyte-table-actions-menu-open kyte-table-actions-menu-up"),$(".kyte-table-actions").not(a).removeClass("dropdown-open");let s=i.hasClass("kyte-table-actions-menu-open");if(s)i.removeClass("kyte-table-actions-menu-open"),a.removeClass("dropdown-open");else{i.css({visibility:"hidden",display:"block"});let l=i.outerHeight();i.css({visibility:"",display:""});let o=t[0].getBoundingClientRect(),n=window.innerHeight,r=window.innerWidth,d=n-o.bottom-10,c=o.top-10,h,u;(h=d>=l||d>=c?o.bottom+4:o.top-l-4)+l>n&&(h=n-l-10),h<10&&(h=10),(u=r-o.right)<10&&(u=10),i.css({top:h+"px",right:u+"px",left:"auto",bottom:"auto"}),i.addClass("kyte-table-actions-menu-open"),a.addClass("dropdown-open")}}),$(document).on("click",function(e){$(e.target).closest(".kyte-table-actions-dropdown").length||($(".kyte-table-actions-menu").removeClass("kyte-table-actions-menu-open kyte-table-actions-menu-up"),$(".kyte-table-actions").removeClass("dropdown-open"))})};_updateSortIndicators=()=>{if(this.tableElement.find(".kyte-table-th").removeClass("kyte-table-sorted-asc kyte-table-sorted-desc"),this.sortColumn){let e=this.tableElement.find(`.kyte-table-th[data-column="${this.sortColumn}"]`);e.addClass(`kyte-table-sorted-${this.sortDirection}`)}};_updatePagination=()=>{let e=this,t=Math.ceil(this.filteredRecords/this.pageLength);if(this.paginationContainer.empty(),t<=1)return;let i=$('<div class="kyte-table-page-buttons"></div>'),a=$(`<button class="kyte-table-page-btn ${1===this.currentPage?"disabled":""}" data-page="${this.currentPage-1}"><i class="fas fa-chevron-left"></i></button>`);i.append(a);let s=Math.max(1,this.currentPage-Math.floor(3.5)),l=Math.min(t,s+7-1);l-s<6&&(s=Math.max(1,l-7+1)),s>1&&(i.append('<button class="kyte-table-page-btn" data-page="1">1</button>'),s>2&&i.append('<span class="kyte-table-page-ellipsis">...</span>'));for(let o=s;o<=l;o++){let n=$(`<button class="kyte-table-page-btn ${o===this.currentPage?"active":""}" data-page="${o}">${o}</button>`);i.append(n)}l<t&&(l<t-1&&i.append('<span class="kyte-table-page-ellipsis">...</span>'),i.append(`<button class="kyte-table-page-btn" data-page="${t}">${t}</button>`));let r=$(`<button class="kyte-table-page-btn ${this.currentPage===t?"disabled":""}" data-page="${this.currentPage+1}"><i class="fas fa-chevron-right"></i></button>`);i.append(r),this.paginationContainer.append(i),i.find(".kyte-table-page-btn:not(.disabled)").on("click",function(){let t=parseInt($(this).data("page"));t&&t!==e.currentPage&&(e.currentPage=t,e._loadData())})};_updateRecordCount=()=>{let e=(this.currentPage-1)*this.pageLength+1,t=Math.min(this.currentPage*this.pageLength,this.filteredRecords),i="";i=0===this.filteredRecords?"No entries":this.filteredRecords===this.totalRecords?`Showing ${e} to ${t} of ${this.totalRecords} entries`:`Showing ${e} to ${t} of ${this.filteredRecords} entries (filtered from ${this.totalRecords} total)`,this.container.find(".kyte-table-record-count").text(i)};_injectStyles=()=>{if($("#kyte-table-styles").length>0)return;let e=`
			<style id="kyte-table-styles">
				.kyte-table-container {
					font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
					font-size: 14px;
					color: #2d3748;
					background: white;
					box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
					overflow: visible;
					position: relative;
				}

				.kyte-table-toolbar {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 16px 20px;
					background: #f8fafc;
					border-bottom: 1px solid #e2e8f0;
					border-radius: 8px 8px 0 0;
				}

				.kyte-table-search {
					position: relative;
					display: flex;
					align-items: center;
				}

				.kyte-table-search i {
					position: absolute;
					left: 12px;
					color: #a0aec0;
					pointer-events: none;
				}

				.kyte-table-search-input {
					padding: 8px 36px 8px 36px;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					font-size: 14px;
					width: 300px;
					transition: all 0.2s;
				}

				.kyte-table-search-input:focus {
					outline: none;
					border-color: #ff6b35;
					box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
				}

				.kyte-table-search-clear {
					position: absolute;
					right: 8px;
					background: none;
					border: none;
					color: #a0aec0;
					cursor: pointer;
					padding: 4px;
					border-radius: 4px;
					transition: all 0.2s;
				}

				.kyte-table-search-clear:hover {
					color: #718096;
					background: #e2e8f0;
				}

				.kyte-table-info {
					color: #718096;
					font-size: 13px;
				}

				.kyte-table-wrapper {
					overflow-x: auto;
					overflow-y: visible;
					position: relative;
				}

				.kyte-table {
					width: 100%;
					border-collapse: collapse;
					border-spacing: 0;
					overflow: visible;
				}

				.kyte-table tbody {
					overflow: visible;
				}

				.kyte-table thead {
					position: sticky;
					top: 0;
					z-index: 9;
					background: white;
				}

				.kyte-table-th {
					text-align: left;
					padding: 12px 16px;
					font-weight: 600;
					color: #4a5568;
					background: #f8fafc;
					border-bottom: 2px solid #e2e8f0;
					white-space: nowrap;
					user-select: none;
				}

				.kyte-table-th-content {
					display: flex;
					align-items: center;
					gap: 8px;
				}

				.kyte-table-sortable {
					cursor: pointer;
					transition: background 0.2s;
				}

				.kyte-table-sortable:hover {
					background: #edf2f7;
				}

				.kyte-table-sort-indicator {
					display: inline-block;
					width: 12px;
					height: 12px;
					opacity: 0.3;
				}

				.kyte-table-sort-indicator::before {
					content: '⇅';
					font-size: 12px;
				}

				.kyte-table-sorted-asc .kyte-table-sort-indicator {
					opacity: 1;
				}

				.kyte-table-sorted-asc .kyte-table-sort-indicator::before {
					content: '↑';
				}

				.kyte-table-sorted-desc .kyte-table-sort-indicator {
					opacity: 1;
				}

				.kyte-table-sorted-desc .kyte-table-sort-indicator::before {
					content: '↓';
				}

				.kyte-table-body tr {
					border-bottom: 1px solid #e2e8f0;
					transition: background 0.2s;
				}

				.kyte-table-body tr:hover {
					background: #f8fafc;
				}

				.kyte-table-body.kyte-table-clickable tr {
					cursor: pointer;
				}

				.kyte-table-body.kyte-table-clickable tr:hover {
					background: #edf2f7;
				}

				.kyte-table-body td {
					padding: 12px 16px;
					color: #2d3748;
					vertical-align: middle;
				}

				.kyte-table-actions {
					text-align: right;
					white-space: nowrap;
					position: relative;
					z-index: 1;
				}

				.kyte-table-actions.dropdown-open {
					z-index: 1001;
				}

				.kyte-table-actions-header {
					width: 80px;
				}

				.kyte-table-action-btn {
					display: inline-block;
					padding: 6px 12px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					font-size: 13px;
					cursor: pointer;
					transition: all 0.2s;
					margin-left: 8px;
				}

				.kyte-table-action-btn:hover {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-actions-dropdown {
					position: relative;
					display: inline-block;
				}

				.kyte-table-actions-toggle {
					padding: 6px 10px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					cursor: pointer;
					transition: all 0.2s;
				}

				.kyte-table-actions-toggle:hover {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-actions-menu {
					position: fixed;
					min-width: 160px;
					background: white;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
					display: none;
					z-index: 9999;
					max-height: 400px;
					overflow-y: auto;
				}

				.kyte-table-actions-menu.kyte-table-actions-menu-open {
					display: block;
					animation: kyte-dropdown-fade-in 0.2s ease;
				}

				@keyframes kyte-dropdown-fade-in {
					from {
						opacity: 0;
						transform: translateY(-8px);
					}
					to {
						opacity: 1;
						transform: translateY(0);
					}
				}

				.kyte-table-actions-menu a {
					display: block;
					padding: 10px 16px;
					color: #4a5568;
					text-decoration: none;
					transition: background 0.2s;
				}

				.kyte-table-actions-menu a:hover {
					background: #f8fafc;
				}

				.kyte-table-actions-menu a i {
					width: 16px;
					margin-right: 8px;
					color: #a0aec0;
				}

				.kyte-table-actions-divider {
					height: 1px;
					background: #e2e8f0;
					margin: 4px 0;
				}

				.kyte-table-skeleton-row td {
					padding: 12px 16px;
				}

				.kyte-table-skeleton {
					height: 16px;
					background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
					background-size: 200% 100%;
					border-radius: 4px;
					animation: kyte-skeleton-loading 1.5s infinite;
				}

				@keyframes kyte-skeleton-loading {
					0% {
						background-position: 200% 0;
					}
					100% {
						background-position: -200% 0;
					}
				}

				.kyte-table-empty,
				.kyte-table-error {
					text-align: center;
					padding: 40px 20px;
					color: #a0aec0;
				}

				.kyte-table-empty i,
				.kyte-table-error i {
					display: block;
					font-size: 32px;
					margin-bottom: 12px;
					opacity: 0.5;
				}

				.kyte-table-error {
					color: #e53e3e;
				}

				.kyte-table-footer {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 16px 20px;
					background: #f8fafc;
					border-top: 1px solid #e2e8f0;
					border-radius: 0 0 8px 8px;
					position: relative;
					z-index: 0;
				}

				.kyte-table-page-size {
					display: flex;
					align-items: center;
					gap: 8px;
					font-size: 13px;
					color: #718096;
				}

				.kyte-table-page-size-select {
					padding: 6px 8px;
					border: 1px solid #e2e8f0;
					border-radius: 6px;
					font-size: 13px;
					background: white;
					cursor: pointer;
				}

				.kyte-table-page-buttons {
					display: flex;
					align-items: center;
					gap: 4px;
				}

				.kyte-table-page-btn {
					min-width: 32px;
					height: 32px;
					padding: 0 8px;
					border: 1px solid #e2e8f0;
					background: white;
					color: #4a5568;
					border-radius: 6px;
					font-size: 13px;
					cursor: pointer;
					transition: all 0.2s;
				}

				.kyte-table-page-btn:hover:not(.disabled):not(.active) {
					background: #f8fafc;
					border-color: #cbd5e0;
				}

				.kyte-table-page-btn.active {
					background: #ff6b35;
					border-color: #ff6b35;
					color: white;
				}

				.kyte-table-page-btn.disabled {
					opacity: 0.5;
					cursor: not-allowed;
				}

				.kyte-table-page-ellipsis {
					padding: 0 4px;
					color: #a0aec0;
				}

				/* Responsive */
				@media (max-width: 768px) {
					.kyte-table-toolbar {
						flex-direction: column;
						gap: 12px;
						align-items: flex-start;
					}

					.kyte-table-search-input {
						width: 100%;
					}

					.kyte-table-footer {
						flex-direction: column;
						gap: 12px;
						align-items: flex-start;
					}

					.kyte-table-page-buttons {
						width: 100%;
						justify-content: center;
					}
				}
			</style>
		`;$("head").append(e)};bindEdit=e=>{this.editForm=e};row=e=>{let t=$(e).closest("tr");return{data:()=>t.data("rowData"),node:()=>t[0],remove:()=>({draw:()=>this._loadData()})}};draw=()=>{this._loadData()};api=()=>({table:()=>({container:()=>this.container[0]})})}class KyteForm{constructor(e,t,i,a,s,l="Form",o=null,n=!1,r=null,d=null,c=null){this.api=e,this.model=i,this.modal=n,this.modalButton=r,this.KyteTable=o,this.title=l,this.hiddenFields=a,this.elements=s,this.id,this.submitButton="Submit",this.httpHeaders=[],this.fileUploadField=null,this.itemized=!1,this.externalChildData=!1,this.success=d,this.fail=c,this.loaded=!1,this.selector=t,this.selectedRow=null,this.editOnlyMode=!1,this.isValid=!0,this.validate=null,this.showLoadingOverlay=!0,this.loadingText=null,this.showSuccessToast=!1,this.successMessage="Saved successfully",this.autoCloseModal=!0,this.autoCloseDelay=0,this.resetOnSuccess=!0,this.validateOnBlur=!1,this.showInlineErrors=!1,this.scrollToFirstError=!1,this.trackDirtyState=!1,this.confirmDirtyClose=!1,this._isDirty=!1,this._originalData=null,this.disableSubmitOnProcess=!0,this.submitButtonLoadingText=null,this.focusFirstField=!0,this.trapFocus=!0,this.debug=!1,this.events={beforeInit:null,afterInit:null,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,beforeSubmit:null,afterSubmit:null,beforeValidate:null,afterValidate:null,onFieldChange:null,onError:null,onDirtyChange:null}}_getFieldId=e=>{for(let t of this.elements)for(let i of t)if(i.field===e)return i.id||`form_${this.model}_${this.id}_${e}`;return`form_${this.model}_${this.id}_${e}`};_emitEvent=(e,...t)=>{if(this.events[e]&&"function"==typeof this.events[e]){let i=this.events[e](...t);return this.debug&&console.log(`[KyteForm:${this.model}] Event: ${e}`,t,"Result:",i),i}};_log=(e,...t)=>{this.debug&&console.log(`[KyteForm:${this.model}] ${e}`,...t)};_checkDirtyState=()=>{if(!this.trackDirtyState||!this._originalData)return;let e=this.getData(),t=this._isDirty;this._isDirty=JSON.stringify(e)!==JSON.stringify(this._originalData),t!==this._isDirty&&this._emitEvent("onDirtyChange",this._isDirty)};_triggerFormChange=()=>{this.trackDirtyState&&this._checkDirtyState()};_refreshTable=()=>{this.KyteTable&&this.KyteTable.draw()};_showLoading=()=>{if(this.showLoadingOverlay&&$(`#${this.model}_${this.id}_modal-loader`).modal("show"),this.disableSubmitOnProcess){let e=$(`#form_${this.model}_${this.id} [type="submit"]`);e.prop("disabled",!0),this.submitButtonLoadingText&&e.data("original-text",e.val()||e.text()).val(this.submitButtonLoadingText)}};_hideLoading=()=>{if($(`#${this.model}_${this.id}_modal-loader`).modal("hide"),this.disableSubmitOnProcess){let e=$(`#form_${this.model}_${this.id} [type="submit"]`);e.prop("disabled",!1),e.data("original-text")&&e.val(e.data("original-text"))}};_showSuccessToast=()=>{if("undefined"!=typeof bootstrap&&bootstrap.Toast){let e=`
				<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
					<div class="toast align-items-center text-white bg-success" role="alert">
						<div class="d-flex">
							<div class="toast-body">${this.successMessage}</div>
							<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
						</div>
					</div>
				</div>`;$("body").append(e);let t=new bootstrap.Toast($(".toast").last()[0]);t.show(),$(".toast").last().on("hidden.bs.toast",function(){$(this).closest(".toast-container").remove()})}};_formatErrorMessage=e=>{if(e&&e.responseJSON){let t=e.responseJSON;if(t.error)return t.error;if(t.message)return t.message;if(t.errors&&Array.isArray(t.errors))return t.errors.map(e=>e.message||e).join("<br>")}if("string"==typeof e)return e;if(e instanceof Error)return e.message;if("object"==typeof e){if(e.error)return e.error;if(e.message)return e.message}return"An error occurred. Please try again."};getData=()=>{let e={},t=$(`#form_${this.model}_${this.id}`);return t.serializeArray().forEach(t=>{if(t.name.endsWith("[]")){let i=t.name.slice(0,-2);e[i]||(e[i]=[]),e[i].push(t.value)}else e[t.name]=t.value}),e};getFieldValue=e=>{let t=this._getFieldId(e);return $(`#${t}`).val()};setFieldValue=(e,t,i=!0)=>{let a=this._getFieldId(e);$(`#${a}`).val(t),i&&$(`#${a}`).trigger("change")};setData=e=>{Object.entries(e).forEach(([e,t])=>{this.setFieldValue(e,t,!1)}),this._triggerFormChange()};clearForm=()=>{this.resetForm()};isEditMode=()=>{let e=this.editOnlyMode||this.getID();return e&&e>0};isDirty=()=>this._isDirty;markClean=()=>{this._isDirty=!1,this._originalData=this.getData(),this._emitEvent("onDirtyChange",!1)};markDirty=()=>{this._isDirty=!0,this._emitEvent("onDirtyChange",!0)};submit=()=>{$(`#form_${this.model}_${this.id}`).submit()};refreshSelects=()=>{this.reloadAjax()};loadRecord=(e,t=null,i=null)=>{this.setID(e),this.loadFormData(e,t,i)};validateForm=()=>{let e=[],t=$(`#form_${this.model}_${this.id}`);return this._emitEvent("beforeValidate",this.getData()),t.find("input, textarea, select").each((t,i)=>{let a=$(i);a.prop("required")&&!a.val()?(e.push({field:a.attr("name"),element:i,message:"This field is required"}),a.addClass("is-invalid").removeClass("is-valid"),this.showInlineErrors&&(a.siblings(".invalid-feedback").remove(),a.after('<div class="invalid-feedback" style="display:block;">This field is required</div>'))):(a.addClass("is-valid").removeClass("is-invalid"),a.siblings(".invalid-feedback").remove())}),this.isValid=0===e.length,this._emitEvent("afterValidate",this.isValid,e),!this.isValid&&this.scrollToFirstError&&e.length>0&&(e[0].element.scrollIntoView({behavior:"smooth",block:"center"}),e[0].element.focus()),{isValid:this.isValid,invalidFields:e}};setFieldError=(e,t)=>{let i=this._getFieldId(e),a=$(`#${i}`);a.addClass("is-invalid").removeClass("is-valid"),this.showInlineErrors&&(a.siblings(".invalid-feedback").remove(),a.after(`<div class="invalid-feedback" style="display:block;">${t}</div>`))};clearFieldError=e=>{let t=this._getFieldId(e),i=$(`#${t}`);i.removeClass("is-invalid is-valid"),i.siblings(".invalid-feedback").remove()};clearValidation=()=>{let e=$(`#form_${this.model}_${this.id}`);e.find(".is-invalid, .is-valid").removeClass("is-invalid is-valid"),e.find(".invalid-feedback").remove(),this.clearErrorMessage()};resetForm=()=>{let e=$(`#form_${this.model}_${this.id}`);e.data("idx",""),e.data("row",""),this.clearErrorMessage(),this.clearValidation(),e.find('input[type="text"], input[type="email"], input[type="password"], input[type="tel"], input[type="number"]').val(""),e.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),e.find("select").prop("selectedIndex",0),e.find("textarea").val(""),this.itemized&&$(`#itemized_${this.model}_${this.id}`).html(""),this._isDirty=!1,this._originalData=null,e.trigger("reset"),this.selectedRow=null};getFormElement=()=>$(`#form_${this.model}_${this.id}`);getModalElement=()=>this.modal?$(`#modal_${this.model}_${this.id}`):null;addHiddenField=(e,t)=>{let i=$(`#form_${this.model}_${this.id}`),a=i.find(`input[type="hidden"][name="${e}"]`);a.length?a.val(t):i.append(`<input type="hidden" name="${e}" value="${t}">`)};removeHiddenField=e=>{$(`#form_${this.model}_${this.id} input[type="hidden"][name="${e}"]`).remove()};setDisabled=e=>{let t=$(`#form_${this.model}_${this.id}`);t.find("input, textarea, select, button").prop("disabled",e)};setFieldVisible=(e,t)=>{let i=this._getFieldId(e),a=$(`#${i}`).closest(".form-group");t?a.show():a.hide()};init=()=>{if(!this.loaded){this._emitEvent("beforeInit"),this.id=this.makeID(8);let e="",t=this;if(this.modal&&(this.modalButton&&this.modalButton.on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#modal_"+t.model+"_"+t.id).modal("show")}),e+=`
<div class="modal fade" id="modal_${this.model}_${this.id}" tabindex="-1" role="dialog" aria-labelledby="modal_${this.model}_${this.id}" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header text-center">
				<h4 class="modal-title w-100 fw-bold">${this.title}</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body mx-3">`),e+=`
				<div id="${this.model}_${this.id}_modal-loader" class="modal" style="background: white; opacity: 0.6;" data-backdrop="static" data-keyboard="false" tabindex="-1">
					<div class="modal-dialog modal-sm h-100 d-flex">
						<div class="mx-auto align-self-center" style="width: 48px">
							<div class="spinner-wrapper text-center fa-6x"><span class="fas fa-sync fa-spin"></span></div>
						</div>
					</div>
				</div>
				<form novalidate="novalidate" class="needs-validation" id="form_${this.model}_${this.id}">
					<div class="error-msg"></div>`,this.hiddenFields&&this.hiddenFields.forEach(function(i){e+=`<input type="hidden" id="${void 0!==i.id?i.id:`form_${t.model}_${t.id}_${i.name}`}" name="${i.name}" value="${i.value}">`}),this.elements.forEach(function(i){e+='<div class="row my-2">',i.forEach(function(i){e+=`<div class="col-sm${void 0!==i.col?"-"+i.col:""}"><div class="form-group">`;let a=void 0!==i.id?i.id:`form_${t.model}_${t.id}_${i.field}`;if(i.label&&(e+=`<label for="${a}">${i.label}</label>`),"select"==i.type){if(e+=`<select id="${a}" class="form-select" name="${i.field}"${i.required?' required="required"':""}>`,i.placeholder&&(e+=`<option selected="selected" disabled>${i.placeholder}</option>`),!i.option.ajax)for(var s in i.option.data)i.option.data.hasOwnProperty(s)&&(e+=`<option value="${s}">${i.option.data[s]}</option>`);e+="</select>"}else"textarea"==i.type?e+=`<textarea style="width:100%" id="${a}" class="form-control" name="${i.field}"${i.required?' required="required"':""}${void 0!==i.placeholder?' placeholder="'+i.placeholder+'"':""} ${void 0!==i.maxlength?' maxlength="'+i.maxlength+'"':""}></textarea>`:"file"==i.type?(e+=`<input type="file" id="${a}" name="${i.field}" class="form-control" data-max-file-size="2M" accept="image/*;capture=camera"${i.required?' required="required"':""} />`,t.fileUploadField=a):e+=`<input type="${i.type}" id="${a}" class="form-control" name="${i.field}"${i.required?' required="required"':""}${void 0!==i.placeholder?' placeholder="'+i.placeholder+'"':""}${void 0!==i.value?' value="'+i.value+'"':""}${void 0!==i.readonly?" readonly":""} ${void 0!==i.maxlength?' maxlength="'+i.maxlength+'"':""}/>`;"function"==typeof i.click&&$("body").on("click",`#${a}`,function(e){i.click(t,$(`#${a}`),e)}),"function"==typeof i.change&&$("body").on("change",`#${a}`,function(e){i.change(t,$(`#${a}`),e)}),e+="</div></div>"}),e+="</div>"}),this.itemized&&(e+=`<hr><h6>${this.itemized.title}</h6><div class="row">`,this.itemized.fields.forEach(function(t){e+=`<div class="col">${t.label}</div>`}),e+=`<div class="col"></div></div><div id="itemized_${this.model}_${this.id}"></div><div class="row my-4"><div class="col text-end"><a href="#" class="itemized-add-item btn btn-sm btn-outline-secondary">Add</a></div></div><hr>`),e+=`<div class="row my-4"><div class="col text-center"><input type="submit" name="submit" value="${t.submitButton}" class="btn btn-primary btn-medium d-sm-inline-block"></div></div>`,e+="</form>",this.modal&&(e+="</div></div></div></div>"),"string"==typeof this.selector&&($("body").append(`<div id="${this.selector}"></div>`),this.selector=$(this.selector)),this.selector.append(e),this.reloadAjax(),$(`#form_${this.model}_${this.id}`).submit(function(e){var i=$(this);if(e.preventDefault(),t.isValid=!0,i.find("input").each(function(){$(this).prop("required")&&!$(this).val()?(t.isValid=!1,$(this).addClass("is-invalid"),$(this).removeClass("is-valid")):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"))}),i.find("textarea").each(function(){$(this).prop("required")&&!$(this).val()?(t.isValid=!1,$(this).addClass("is-invalid"),$(this).removeClass("is-valid")):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"))}),"function"==typeof t.validate&&t.validate(t),t.isValid){let a=t.editOnlyMode?t.editOnlyMode:i.data("idx");if(a>0){if(!1===t._emitEvent("beforeSubmit",t.getData(),!0))return;t._showLoading(),t.api.put(t.model,"id",a,null,i.serialize(),t.httpHeaders,function(e){t._hideLoading(),t._refreshTable(),"function"==typeof t.success&&t.success(e),t._emitEvent("afterSubmit",e,!0),t.resetOnSuccess&&$(`#form_${t.model}_${t.id}`).trigger("reset"),t.showSuccessToast&&t._showSuccessToast(),t.autoCloseModal&&setTimeout(()=>t.hideModal(!0),t.autoCloseDelay)},function(e){t._hideLoading(),t.appendErrorMessage(e),t._emitEvent("onError",e,"update"),"function"==typeof t.fail&&t.fail(e)})}else{if(!1===t._emitEvent("beforeSubmit",t.getData(),!1))return;if(t._showLoading(),t.fileUploadField){let s=document.getElementById(t.fileUploadField).files[0];s&&i.append(`<input id="filename" type="hidden" name="filename" value="${s.name}" />`)}t.api.post(t.model,null,i.serialize(),t.httpHeaders,function(e){if(t._refreshTable(),t.fileUploadField&&e.data[0].s3endpoint){$("#filename").remove();let i=e.data[0].id,a=document.getElementById(t.fileUploadField).files[0],s=new FormData;s.append("acl","private"),s.append("key",e.data[0].key),s.append("policy",e.data[0].policy),s.append("x-amz-algorithm","AWS4-HMAC-SHA256"),s.append("x-amz-credential",e.data[0].credential),s.append("x-amz-date",e.data[0].date),s.append("x-amz-signature",e.data[0].signature),s.append("file",a),$.ajax({url:e.data[0].s3endpoint,type:"post",data:s,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(i){t._hideLoading(),"function"==typeof t.success&&t.success(e),t._emitEvent("afterSubmit",e,!1),t.resetOnSuccess&&$(`#form_${t.model}_${t.id}`).trigger("reset"),t.showSuccessToast&&t._showSuccessToast(),t.autoCloseModal&&setTimeout(()=>t.hideModal(!0),t.autoCloseDelay)},error:function(e){t._hideLoading(),t.appendErrorMessage(e),t._emitEvent("onError",e,"upload"),"function"==typeof t.fail&&t.fail(e),t.api.delete(t.model,"id",i,[])}})}else t._hideLoading(),"function"==typeof t.success&&t.success(e),t._emitEvent("afterSubmit",e,!1),t.resetOnSuccess&&$(`#form_${t.model}_${t.id}`).trigger("reset"),t.showSuccessToast&&t._showSuccessToast(),t.autoCloseModal&&setTimeout(()=>t.hideModal(!0),t.autoCloseDelay)},function(e){t._hideLoading(),t.appendErrorMessage(e),t._emitEvent("onError",e,"create"),"function"==typeof t.fail&&t.fail(e)})}}}),this.modal&&($("#modal_"+this.model+"_"+this.id).on("hidden.bs.modal",function(e){if(e.target.id=="modal_"+t.model+"_"+t.id){var i=$(`#form_${t.model}_${t.id}`);i.data("idx",""),i.data("row",""),i.find(".error-msg").html(""),i.find("input").each(function(){$(this).removeClass("is-invalid"),$(this).removeClass("is-valid")}),i.find('input[type="text"').each(function(){$(this).val("")}),i.find('input[type="email"').each(function(){$(this).val("")}),i.find('input[type="password"').each(function(){$(this).val("")}),i.find('input[type="tel"').each(function(){$(this).val("")}),i.find('input[type="checkbox"').each(function(){$(this).prop("checked",!1)}),i.find('input[type="radio"').each(function(){$(this).prop("checked",!1)}),i.find("select").each(function(){$(this).prop("selectedIndex",0)}),i.find("textarea").each(function(){$(this).val("")}),t.itemized&&$("#itemized_"+t.model+"_"+t.id).html(""),$(`#form_${t.model}_${t.id}`).trigger("reset")}}),$("#modal_"+this.model+"_"+this.id).on("shown.bs.modal",function(e){if(e.target.id=="modal_"+t.model+"_"+t.id){var i=$(`#form_${t.model}_${t.id}`);let a=t.editOnlyMode?t.editOnlyMode:i.data("idx");a?($(`#${t.model}_${t.id}_modal-loader`).modal("show"),t.loadFormData(a,function(){$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.trackDirtyState&&(t._originalData=t.getData()),t._emitEvent("afterOpen",a,t.getData())},function(){$(`#${t.model}_${t.id}_modal-loader`).modal("hide"),t.hideModal(),console.error("Unable to load form. Please try again later")})):(t.trackDirtyState&&(t._originalData=t.getData()),t._emitEvent("afterOpen",null,null)),t.focusFirstField&&i.find('input:not([type="hidden"]), textarea, select').first().focus()}})),this.itemized&&($(`#form_${this.model}_${this.id}`).on("click",".itemized-add-item",function(e){var i=t.makeID(8);e.preventDefault();let a='<div class="row itemized-row my-3">';t.itemized.fields.forEach(function(e){if(a+='<div class="col"><div class="form-group">',"select"==e.type){if(a+=`<select id="${e.option.data_model_name}_${e.option.data_model_value}_${i}" id="itemized_${t.model}_${t.id}_${e.name}" class="form-select" name="${e.name}"${e.required?' required="required"':""}>`,!e.option.ajax)for(var s in e.option.data)e.option.data.hasOwnProperty(s)&&(a+=`<option value="${s}">${e.option.data[s]}</option>`);a+="</select>"}else"textarea"==e.type?a+=`<textarea style="width:100%" id="itemized_${t.model}_${t.id}_${e.name}" class="form-control" name="${e.name}"${e.required?' required="required"':""}${void 0!==e.placeholder?' placeholder="'+e.placeholder+'"':""}></textarea>`:a+=`<input type="${e.type}" id="itemized_${t.model}_${t.id}_${e.name}" class="form-control" name="${e.name}"${e.required?' required="required"':""}${void 0!==e.placeholder?' placeholder="'+e.placeholder+'"':""}${void 0!==e.readonly?" readonly":""}>`;a+="</div></div>"}),a+='<div class="col-2 text-end"><a href="#" class="itemized-delete-item btn btn-sm btn-outline-danger">remove</a></div></div>',$(`#itemized_${t.model}_${t.id}`).append(a),t.itemized.fields.forEach(function(e){"select"==e.type&&e.option.ajax&&t.api.get(e.option.data_model_name,e.option.data_model_field,e.option.data_model_value,[],function(t){t.data.forEach(function(t){let a="";e.option.data_model_attributes.forEach(function(e){if(t[e])a+=t[e]+" ";else{let i=e.split(".");i.length>=2?a+=t[i[0]][i[1]]+" ":a+=e+" "}}),$(`#${e.option.data_model_name}_${e.option.data_model_value}_${i}`).append(`<option value="${t.id}">${a}</option>`)})})})}),$(`#form_${this.model}_${this.id}`).on("click",".itemized-delete-item",function(e){e.preventDefault(),$(this).closest(".itemized-row").remove()})),this.trackDirtyState){let i=$(`#form_${this.model}_${this.id}`);i.on("change","input, textarea, select",()=>{this._checkDirtyState()}),i.on("input","input, textarea",()=>{this._checkDirtyState()})}if(this.validateOnBlur){let a=$(`#form_${this.model}_${this.id}`);a.on("blur","input, textarea, select",e=>{let t=$(e.target);t.prop("required")&&!t.val()?(t.addClass("is-invalid").removeClass("is-valid"),this.showInlineErrors&&(t.siblings(".invalid-feedback").remove(),t.after('<div class="invalid-feedback" style="display:block;">This field is required</div>'))):t.val()&&(t.addClass("is-valid").removeClass("is-invalid"),t.siblings(".invalid-feedback").remove())})}this._emitEvent("afterInit"),this.loaded=!0}};appendErrorMessage=(e,t=!0)=>{let i=this._formatErrorMessage(e),a=t?`<div class="alert alert-danger alert-dismissible fade show" role="alert">
				 ${i}
				 <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			   </div>`:`<div class="alert alert-danger" role="alert">${i}</div>`;$(`#form_${this.model}_${this.id} .error-msg`).append(a)};_appendErrorMessageLegacy=e=>{$(`#form_${this.model}_${this.id} .error-msg`).append(`<div class="alert alert-danger" role="alert">${e}</div>`)};clearErrorMessage=()=>{$(`#form_${this.model}_${this.id} .error-msg`).html("")};showModal=(e=null)=>{this.modal&&(e&&this.setID(e),!1!==this._emitEvent("beforeOpen",e)&&$(`#modal_${this.model}_${this.id}`).modal("show"))};hideModal=(e=!1)=>{if(this.modal){if(!e&&this.confirmDirtyClose&&this._isDirty){this.api.confirm("Unsaved Changes","You have unsaved changes. Are you sure you want to close?",()=>this._forceHideModal());return}this._forceHideModal()}};_forceHideModal=()=>{!1!==this._emitEvent("beforeClose")&&($(`#modal_${this.model}_${this.id}`).modal("hide"),this._emitEvent("afterClose"))};loadFormData=(e,t=null,i=null)=>{var a=this;a.externalChildData&&a.httpHeaders.push({name:"x-kyte-get-externaltables",value:"true"}),a.api.get(a.model,"id",e,a.httpHeaders,function(e){a.elements.forEach(function(t){t.forEach(function(t){let i=void 0!==t.id?t.id:`form_${a.model}_${a.id}_${t.field}`;if("object"==typeof e.data[0][t.field]&&null!==e.data[0][t.field])$(`#${i}`).val(e.data[0][t.field].id).change();else{if("date"===t.type){var s=e.data[0][t.field].replace(/\//g,"-");$(`#${i}`).val(s)}else $(`#${i}`).val(e.data[0][t.field]);$(`#${i}`).change()}})}),a.itemized&&(e.data[0].ExternalTables&&e.data[0].ExternalTables.LineItem?a.renderItemizedData(e.data[0].ExternalTables.LineItem):a.itemized.model&&a.itemized.foreign_key?a.api.get(a.itemized.model,a.itemized.foreign_key,e.data[0].id,a.httpHeaders,function(e){a.renderItemizedData(e.data)}):error.log("External tables or model+foreign key not defined. At least one must be defined for itemized forms")),"function"==typeof t&&t()},function(){"function"==typeof t&&t()})};renderItemizedData=e=>{var t=0,i=this;e.forEach(function(e){i.makeID(8);let a='<div class="row itemized-row my-3">';i.itemized.fields.forEach(function(s){var l=s.field?s.field:s.name.replace(/\[\]$/,""),o=i.api.getNestedValue(e,l);if(o=void 0===o?"":o,a+='<div class="col"><div class="form-group">',"select"==s.type){if(a+=`<select id="itemized_${i.model}_${i.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-select itemized_${i.model}_${i.id}_${s.name.replace(/\[\]$/,"")}" name="${s.name}" value="${o}" data-selected-value="${o}"${s.required?' required="required"':""}>`,!s.option.ajax)for(var l in s.option.data)s.option.data.hasOwnProperty(l)&&(a+=`<option value="${l}">${s.option.data[l]}</option>`);a+="</select>"}else"textarea"==s.type?a+=`<textarea style="width:100%" id="itemized_${i.model}_${i.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-control" name="${s.name}" value="${o}"${s.required?' required="required"':""}${void 0!==s.placeholder?' placeholder="'+s.placeholder+'"':""}></textarea>`:a+=`<input type="${s.type}" id="itemized_${i.model}_${i.id}_${s.name.replace(/\[\]$/,"")}[${t}]" class="form-control" name="${s.name}" value="${o=s.date?o.replace(/\//g,"-"):o}"${s.required?'required="required"':""}${void 0!==s.placeholder?' placeholder="'+s.placeholder+'"':""}${void 0!==s.readonly?" readonly":""}>`;a+="</div></div>"}),a+='<div class="col-2 text-end"><a href="#" class="itemized-delete-item btn btn-sm btn-outline-danger">remove</a></div></div>',$(`#itemized_${i.model}_${i.id}`).append(a),t++}),i.itemized.fields.forEach(function(e){"select"==e.type&&e.option.ajax&&i.api.get(e.option.data_model_name,e.option.data_model_field,e.option.data_model_value,[],function(t){t.data.forEach(function(t){let a="";e.option.data_model_attributes.forEach(function(e){if(t[e])a+=t[e]+" ";else{let i=e.split(".");i.length>=2?a+=t[i[0]][i[1]]+" ":a+=e+" "}});let s=e.option.data_model_default_field?e.option.data_model_default_field:"id";$(`.itemized_${i.model}_${i.id}_${e.name.replace(/\[\]$/,"")}`).append(`<option value="${t[s]}">${a}</option>`)}),$(`.itemized_${i.model}_${i.id}_${e.name.replace(/\[\]$/,"")}`).each(function(){let e=$(this).data("selected-value");$(this).val(e).trigger("change")})})})};reloadAjax=()=>{let e=this;this.elements.forEach(function(t){t.forEach(function(t){let i=void 0!==t.id?t.id:`form_${e.model}_${e.id}_${t.field}`;"select"==t.type&&t.option.ajax&&($(`#${i}`).html(""),t.placeholder&&$(`#${i}`).append(`<option selected="selected" disabled>${t.placeholder}</option>`),e.api.get(t.option.data_model_name,t.option.data_model_field,t.option.data_model_value,[],function(e){e.data.forEach(function(e){let a="";t.option.data_model_attributes.forEach(function(t){if(e[t])a+=e[t]+" ";else{let i=t.split(".");i.length>=2?a+=e[i[0]][i[1]]+" ":a+=t+" "}});let s=t.option.data_model_default_field?t.option.data_model_default_field:"id";$(`#${i}`).append(`<option value="${e[s]}"${e[s]==t.option.data_model_default_value?' selected="selected"':""}>${a}</option>`)})},function(){console.error(`Unable to load form dropdown data for ${t.option.data_model_name}`)}))})})};setID=e=>{$(`#form_${this.model}_${this.id}`).data("idx",e)};getID=()=>$(`#form_${this.model}_${this.id}`).data("idx");makeID=e=>{for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*a));return t}}class KyteCalendar{constructor(e){this.selector=e,this.Days=["Su","Mo","Tu","We","Th","Fr","Sa"],this.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.selectedDate=null,this.selectedEndDate=null,this.callback=null,this.date=new Date,this.rowMonths=1,this.colMonths=0,this.selectedActiveClass="calendar-date-active",this.selectedEndActiveClass="calendar-date-active",this.fieldInFocus=null}init=()=>{let e=this,t='<div class="kyte-calendar">';this.colMonths=$(this.selector).data("colMonths"),this.rowMonths=$(this.selector).data("rowMonths"),t+='<div class="d-flex justify-content-between mb-2"><a href="#" class="calendar-back"><i class="fas fa-arrow-alt-circle-left fa-3x"></i></a><a href="#" class="calendar-forward"><i class="fas fa-arrow-alt-circle-right fa-3x"></i></a></div>',t+='<div class="row kyte-calendar-row">',t+=this.generateRow(function(e,t){return 0==e&&0==t?0:1}),t+="</div></div>",$(this.selector).html(t),$(".kyte-calendar").on("click",".calendar-forward",function(t){t.preventDefault(),t.stopPropagation(),e.date.setMonth(e.date.getMonth()+e.colMonths*e.rowMonths*2),$(".kyte-calendar-row").html(e.generateRow())}),$(".kyte-calendar").on("click",".calendar-back",function(t){t.preventDefault(),t.stopPropagation(),$(".kyte-calendar-row").html(e.generateRow())}),$(".kyte-calendar").on("click",".calendar-date-content",function(t){t.preventDefault(),t.stopPropagation();let i=$(this).data("calendarYear"),a=$(this).data("calendarMonth"),s=$(this).data("calendarDate");$(".calendar-date-content").removeClass(e.selectedActiveClass),$(".calendar-date-content").removeClass(e.selectedEndActiveClass);let l=new Date(i,a,s);"range"==$(e.selector).data("selectionType")?e.fieldInFocus?(console.log("test"),console.log(e.fieldInFocus.data("date-target")),"start"==e.fieldInFocus.data("date-target")?(e.selectedDate=l,e.selectedDate>e.selectedEndDate&&(e.selectedEndDate=null)):(e.selectedEndDate=l,e.selectedDate>e.selectedEndDate&&(e.selectedDate=null)),e.fieldInFocus=null):null==e.selectedDate?e.selectedDate=l:e.selectedDate>l?(e.selectedDate=l,e.selectedEndDate=null):null==e.selectedEndDate?e.selectedEndDate=l:(e.selectedDate=l,e.selectedEndDate=null):e.selectedDate=new Date(i,a,s),null!=e.selectedEndDate&&$(".calendar-element-"+e.selectedEndDate.getFullYear()+"-"+e.selectedEndDate.getMonth()+"-"+e.selectedEndDate.getDate()).addClass(e.selectedEndActiveClass),null!=e.selectedDate&&$(".calendar-element-"+e.selectedDate.getFullYear()+"-"+e.selectedDate.getMonth()+"-"+e.selectedDate.getDate()).addClass(e.selectedActiveClass),"function"==typeof e.callback&&e.callback(e.selectedDate,e.selectedEndDate)})};updateSelectedDate=e=>{if(null==e||""==e)this.selectedDate=null;else{let t=new Date(e);this.selectedDate=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),this.selectedDate>this.selectedEndDate&&(this.selectedEndDate=null)}this.fieldInFocus=null,this.redraw()};updateSelectedEndDate=e=>{if(null==e||""==e)this.selectedEndDate=null;else{let t=new Date(e);this.selectedEndDate=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),this.selectedEndDate<this.selectedDate&&(this.selectedDate=null)}this.fieldInFocus=null,this.redraw()};redraw=()=>{this.date.setMonth(this.date.getMonth()+this.colMonths*this.rowMonths),$(".kyte-calendar-row").html(this.generateRow())};generateRow=e=>{if(this.rowMonths<1||this.rowMonths>3){console.error("Invalid option for number of rows to display. Please pick between 1 and 3.");return}if(this.colMonths<1||this.colMonths>3){console.error("Invalid option for number of months to display per col. Please pick between 1 and 3.");return}if("function"==typeof e){if(!Number.isInteger(e(1))){console.error("Modifier does not return an integer. Must return an integer.");return}}else e=function(e){return 1};let t="";this.rowMonths>1&&(t+='<div class="col">');let i=[];for(let a=0;a<this.rowMonths;a++){let s="";this.rowMonths>1&&(s+='<div class="row mb-2">');let l=[];for(let o=0;o<this.colMonths;o++){this.date.setMonth(this.date.getMonth()-e(o,a));let n=this.generateCalendar(this.date);l.push('<div class="col-lg-'+12/this.colMonths+' mb-2 mb-lg-0 px-1">'+n+"</div>")}s+=l.reverse().join(""),this.rowMonths>1&&(s+="</div>"),i.push(s)}return t+=i.reverse().join(""),this.rowMonths>1&&(t+="</div>"),t};generateCalendar=e=>{let t=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),i=new Date(e.getFullYear(),e.getMonth(),1),a=[],s=[],l=0;for(a.push('<div class="row"><div class="col"><div class="calendar-month-label">'+this.Months[e.getMonth()]+" "+e.getFullYear()+"</div></div></div>");l<7;l++)s.push('<div class="col"><div class="calendar-day-of-week">'+this.Days[l]+"</div></div>");a.push('<div class="row">'+s.join("")+"</div>"),s=[],l=0;let o=i.getDay();for(;l<o;l++)s.push('<div class="col"><div class="calendar-date-square"></div></div>');for(let n=1;n<=t;n++){i.setDate(n);let r=!1,d=!1;this.selectedDate&&this.selectedDate.getTime()===i.getTime()&&(r=!0),this.selectedEndDate&&this.selectedEndDate.getTime()===i.getTime()&&(d=!0),l%7==0&&(a.push('<div class="row">'+s.join("")+"</div>"),s=[],l=0),s.push('<div class="col"><div class="calendar-date-square"><a href="#" data-calendar-month="'+e.getMonth()+'" data-calendar-year="'+e.getFullYear()+'" data-calendar-date="'+n+'" data-calendar-day="'+this.Days[l]+'" class="'+(r?this.selectedActiveClass+" ":"")+(d?this.selectedEndActiveClass+" ":"")+"calendar-date-content calendar-element-"+e.getFullYear()+"-"+e.getMonth()+"-"+n+' align-items-center justify-content-center d-flex"><span class="d-flex-column">'+n+"</span></a></div></div>"),l++}for(;l<7;l++)s.push('<div class="col"><div class="calendar-date-square"></div></div>');return a.push('<div class="row">'+s.join("")+"</div>"),'<div class="kyte-calendar-wrapper">'+a.join("")+"</div>"}}class KytePasswordRequirement{constructor(e,t,i,a){this.api=e,this.selector=t,this.passwordField=i,this.confirmField=a,this.minLength=8,this.lengthText="Minimum length of "+this.minLength,this.lowerCaseText="At least one lower case letter",this.upperCaseText="At least one upper case letter",this.numberText="At least one number",this.symbolText="At least one symbol",this.reqLength=!0,this.reqLowerCase=!0,this.reqUpperCase=!0,this.reqNumber=!0,this.reqSymbol=!0,this.valid=!1}init=()=>{let e=this;this.selector.html("");let t='<ul class="fa-ul">';this.reqLength&&(t+='<li class="validate-length"><i class="fa-li far fa-circle"></i> '+this.lengthText+"</li>"),this.reqLowerCase&&(t+='<li class="validate-small"><i class="fa-li far fa-circle"></i> '+this.lowerCaseText+"</li>"),this.reqUpperCase&&(t+='<li class="validate-large"><i class="fa-li far fa-circle"></i> '+this.upperCaseText+"</li>"),this.reqNumber&&(t+='<li class="validate-number"><i class="fa-li far fa-circle"></i> '+this.numberText+"</li>"),this.reqSymbol&&(t+='<li class="validate-symbol"><i class="fa-li far fa-circle"></i> '+this.symbolText+"</li>"),t+="</ul>",this.selector.append(t),this.passwordField.on("keyup",function(){this.valid=e.validatePassword()})};validatePassword=()=>{var e=this.passwordField.val();let t=!0;return e||(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-length i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-small i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-large i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-number i").removeClass("text-success").addClass("text-danger"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-symbol i").removeClass("text-success").addClass("text-danger"),t=!1),this.reqLength&&(e.length<8?(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-length i").removeClass("text-success").addClass("text-danger"),t=!1):(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-length i").removeClass("fa-circle"),$("ul li.validate-length i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-length i").removeClass("text-danger").addClass("text-success"))),this.reqLowerCase&&(e.match(/[a-z]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-small i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-small i").removeClass("fa-circle"),$("ul li.validate-small i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-small i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqUpperCase&&(e.match(/[A-Z]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-large i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-large i").removeClass("fa-circle"),$("ul li.validate-large i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-large i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqNumber&&(e.match(/\d/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-number i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-number i").removeClass("fa-circle"),$("ul li.validate-number i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-number i").removeClass("text-success").addClass("text-danger"),t=!1)),this.reqSymbol&&(e.match(/[@$!%*#?&]/)?(this.passwordField.removeClass("is-invalid").addClass("is-valid"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-times-circle").addClass("fa-check-circle"),$("ul li.validate-symbol i").removeClass("text-danger").addClass("text-success")):(this.passwordField.removeClass("is-valid").addClass("is-invalid"),$("ul li.validate-symbol i").removeClass("fa-circle"),$("ul li.validate-symbol i").removeClass("fa-check-circle").addClass("fa-times-circle"),$("ul li.validate-symbol i").removeClass("text-success").addClass("text-danger"),t=!1)),t}}class KyteWebComponent{constructor(e){if("object"!=typeof e||null===e)throw Error("Components must be an object");this.components=e}bind=(e,t,i,a=null)=>{let s=$(e);if(0===s.length){console.warn(`No element found for selector: ${e}`);return}if(!this.components.hasOwnProperty(t)){console.warn(`Template identifier "${t}" not found.`);return}if(!Array.isArray(i)){console.warn("Data must be an array.");return}let l=this.components[t];s.html(""),i.forEach(e=>{"function"==typeof a&&a(e);let t=this.replacePlaceholders(l,e);s.append(t)})};replacePlaceholders=(e,t)=>e.replace(/{{\s*(\w+)\s*}}/g,(e,i)=>t.hasOwnProperty(i)?t[i]:"")}
